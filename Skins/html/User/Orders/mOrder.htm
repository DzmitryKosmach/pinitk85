<?php echo CssCopmress::load('cart')?>

<div id="title" class="title">
	<div class="centering">
		<div class="centeringin clearfix">
			<?php if(count($breadcrumbs)) { ?>
				<?php $bcLast = array_pop($breadcrumbs); ?>
				<ul class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
					<?php $position = 0; ?>
					<?php foreach($breadcrumbs as $bc) { ?>
						<?php $position = $position + 1 ?>
						<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
							<a href="<?php echo $bc['url']; ?>" title="<?php echo hsch($bc['name'])?>" itemscope itemtype="http://schema.org/Thing"
								itemid="<?php echo $bc['url']; ?>"
								itemprop="item"><span itemprop="name"><?php echo $bc['name']; ?></span></a>
						    <meta itemprop="position" content="<?php echo $position?>" />
						</li>
						<li><span> / </span></li>
					<?php } ?>
					<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<span itemscope itemtype="http://schema.org/Thing" itemid="<?php echo $bc['url']; ?>" itemprop="item">
							<span itemprop="name"><?php echo $bcLast['name']; ?></span>
						</span>
				    	<meta itemprop="position" content="<?php echo $position + 1?>" />
					</li>
				</ul>
			<?php } ?>
			<?php if(trim($pageInf['header'])) { ?>
				<h1 class="pagetitle"><?php echo $pageInf['header']; ?></h1>
			<?php } ?>
		</div>
	</div>
</div>
<div id="content" class="content">
	<div class="centering">
		<div class="centeringin clearfix">
			<?php if(trim($pageInf['text']) !== '') { ?>
				<?php echo ($pageInf['seo_hide'] ? Url_SeoHide::parse($pageInf['text']) : $pageInf['text'])?>
				<div class="cl"></div>
			<?php } ?>

			<?php if($order) { ?>
				<?php
				$cart = $order['cart'];
				$options = $order['options'];
				$user = $order['user'];
				?>
				<div class="order_form_div someform orderforma order-checkout">
					<div class="clearfix">
						<script>
							function fixTblSize(){
								var elLeft = $$$('order-view-left');
								var elRight = $$$('order-view-right');
								var elFixLeft = $$$('fix-size-left');
								var elFixRight = $$$('fix-size-right');

								elFixLeft.style.paddingBottom = '10px';
								elFixRight.style.paddingBottom = '10px';

								if(winSize().w < 885) return;

								var hLeft = elSize(elLeft).h;
								var hRight = elSize(elRight).h;
								if(hLeft > hRight){
									elFixRight.style.paddingBottom = (10 + hLeft - hRight) + 'px';
								}else if(hRight > hLeft){
									elFixLeft.style.paddingBottom = (10 + hRight - hLeft) + 'px';
								}
							}
							onLoad(function(){fixTblSize()});
							addHandler(
								window,
								'resize',
								function(){fixTblSize()}
							);
						</script>

						<div class="order-view-left" id="order-view-left">
							<h4>Заказ</h4>
							<div class="body clearfix">
								<div style="margin-bottom: 5px;">
									ID заказа:
									<strong><?php echo $order['id']; ?></strong>
								</div>
								<div style="margin-bottom: 5px;">
									Оформлен:
									<strong><?php echo date('d.m.Y в H:i', MySQL::fromDateTime($order['date']))?></strong>
								</div>
								<div style="margin-bottom: 5px;">
									Статус:
									<strong style="color: <?php echo $order['status_color']; ?>"><?php echo $order['status_name']; ?></strong>
									<?php if($order['date'] != $order['status_date']) { ?>
										<span style="font-size: 12px;">(обновлён <?php echo date('d.m.Y в H:i', MySQL::fromDateTime($order['status_date']))?>)</span>
									<?php } ?>
								</div>
							</div>

							<h4>Данные покупателя</h4>
							<div class="body clearfix" id="fix-size-left">
								<div style="margin-bottom: 5px;">
									Ф.И.О.:
									<strong><?php echo $user['fio']; ?></strong>
								</div>
								<div style="margin-bottom: 5px;">
									Контактный телефон:
									<strong><?php echo $user['phone']; ?></strong>
								</div>
								<?php if($order['paymethod'] !== Orders::PAYMETHOD_NO) { ?>
									<div style="margin-bottom: 5px;">
										E-mail:
										<strong><?php echo $user['email']; ?></strong>
									</div>
									<div style="margin-bottom: 5px;">
										Город:
										<strong><?php echo $user['city']; ?></strong>
									</div>
									<div style="margin-bottom: 5px;">
										Адрес доставки:
										<strong><?php echo $user['address']; ?></strong>
									</div>
									<div style="margin-bottom: 5px;">
										Примечание:
										<strong><?php echo nl2br($user['info'])?></strong>
									</div>
								<?php } ?>
							</div>
						</div>

						<div class="order-view-right" id="order-view-right">
							<h4>Опции заказа</h4>
							<div class="body clearfix">
								<div style="margin-bottom: 5px;">
									Способ оплаты:
									<strong><?php echo Orders::$paymethods[$order['paymethod']]; ?></strong>
								</div>
								<?php if($order['paymethod'] !== Orders::PAYMETHOD_NO) { ?>
									<div style="margin-bottom: 5px;">
										Доставка:
										<strong>
											<?php echo $options[Orders_Options::DELIVERY]['info']; ?>
											(<?php echo Catalog::priceFormat($options[Orders_Options::DELIVERY]['price'])?> руб.)
										</strong>
									</div>
									<div style="margin-bottom: 5px;">
										Разгрузка:
										<strong>
											<?php echo $options[Orders_Options::UNLOADING]['info']; ?>
											(<?php echo Catalog::priceFormat($options[Orders_Options::UNLOADING]['price'])?> руб.)
										</strong>
									</div>
									<div style="margin-bottom: 5px;">
										Сборка:
										<strong>
											<?php echo $options[Orders_Options::ASSEMBLY]['info']; ?>
											(<?php echo Catalog::priceFormat($options[Orders_Options::ASSEMBLY]['price'])?> руб.)
										</strong>
									</div>
									<div style="margin-bottom: 5px;">
										Вывоз мусора:
										<strong>
											<?php echo $options[Orders_Options::GARBAGE]['info']; ?>
											(<?php echo Catalog::priceFormat($options[Orders_Options::GARBAGE]['price'])?> руб.)
										</strong>
									</div>
								<?php } ?>
							</div>

							<h4>Итоговая стоимость</h4>
							<div class="body clearfix" id="fix-size-right">
								<div class="order-total clearfix">
									<?php if($order['paymethod'] !== Orders::PAYMETHOD_NO) { ?>
										<div style="margin-bottom: 5px;">
											Сумма заказа:
											<strong>
												<?php echo Catalog::priceFormat($order['price_out'])?>
												руб.
											</strong>
										</div>
										<div style="margin-bottom: 15px;">
											Доставка/сборка:
											<strong>
												<?php echo Catalog::priceFormat($order['price_options'])?>
												руб.
											</strong>
										</div>
										<div class="clearfix">
											<div class="price">
												Итого:
												<strong>
													<?php echo Catalog::priceFormat($order['price_out'] + $order['price_options'])?>
													руб.
												</strong>
											</div>
										</div>
									<?php } else { ?>
										<div class="clearfix">
											<div class="price">
												Итого:
												<strong>
													<?php echo Catalog::priceFormat($order['price_out'])?>
													руб.
												</strong>
											</div>
										</div>
									<?php } ?>
								</div>
							</div>
						</div>
					</div>

					<div class="section summary">
						<h4>Товары в заказе</h4>
						<div class="body">
							<table class="products js-element">
								<tr>
									<th class="item nowrap">Серия</th>
									<th class="custom nowrap">Товар</th>
									<th class="custom nowrap">Цвет</th>
									<th class="custom nowrap">Цена</th>
									<th class="custom nowrap">Кол-во</th>
									<th class="custom nowrap">Сумма</th>
								</tr>
								<?php foreach($cart as $c) { ?>
									<tr>
										<td class="item">
											<?php if($c['series']) { ?>
												<a href="<?php echo Catalog_Series::a($c['series'])?>"><?php echo $c['series']['name']; ?></a>
											<?php } ?>
										</td>
										<td class="itemname">
											<div class="pic">
												<?php if($c['item']['_img_ext']) { ?>
													<img
														src="<?php echo Catalog::photoUrl(
															Catalog_Items::$imagePath,
															$c['item']['id'], 30, 30, 1, $c['item']['_img_ext'],
															$c['item']['image-name']
														)?>"
														>
												<?php } ?>
											</div>
											<div class="text">
												<?php echo $c['item']['name']; ?><br>
												<span>
													Арт.: <?php echo $c['item']['art']; ?><br>
													<?php if(trim($c['item']['size']) !== '') { ?>
														Размер: <?php echo $c['item']['size']; ?>
													<?php } ?>
												</span>
											</div>
										</td>
										<td class="material" style="min-width: 100px;">
											<?php if($c['material']) { ?>
												<?php if($c['material']['_img_ext']) { ?>
													<div class="image">
														<a href="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $c['material']['id']; ?>.<?php echo $c['material']['_img_ext']; ?>" target="_blank" onclick="return hs.expand(this, {slideshowGroup: 'default'})">
															<img src="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $c['material']['id']; ?>_24x24_0.<?php echo $c['material']['_img_ext']; ?>" width="24" height="24" alt="<?php echo hsch(implode(' / ', Catalog_Materials::getFullName($c['material']['id'])))?>">
														</a>
													</div>
												<?php } ?>
												<div class="name">
													<?php echo implode('<br>', Catalog_Materials::getFullName($c['material']['id']))?>
												</div>
											<?php } else { ?>
												&nbsp;
											<?php } ?>
										</td>
										<td class="nowrap right">
											<?php if(abs($c['price'])) { ?>
												<?php echo Catalog::priceFormat($c['price'])?>
												руб.
												<?php if(abs($c['item']['discount']) != 1) { ?>
													<?php $d = Catalog::num2percent($c['item']['discount'], Catalog::PC_DECREASE); ?>
													<br>
													<span class="discount" title="Цена со скидкой <?php echo $d?>%">
													(-<?php echo $d?>%)
												</span>
												<?php } ?>
											<?php } else { ?>
												по запросу
											<?php } ?>
										</td>
										<td class="nowrap right">
											<?php echo $c['amount']; ?>
											шт
										</td>
										<td class="nowrap right">
											<?php echo Catalog::priceFormat($c['price'] * $c['amount'])?>
											руб.
										</td>
									</tr>
								<?php } ?>
							</table>
							<div class="order_pay">
								<div class="right">
									<table class="bx_ordercart_order_sum">
										<tr>
											<td class="custom_t1 fwb" colspan="6" class="itog">
												Итого:
											</td>
											<td class="custom_t2 fwb price">
												<?php echo Catalog::priceFormat($order['price_out'])?>
												руб.
											</td>
										</tr>
										<tr>
											<td class="custom_t1" colspan="6"></td>
											<td class="custom_t2">
												<?php echo $order['amount']; ?> шт.
											</td>
										</tr>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			<?php } else { ?>
				<?php echo Pages::msgErr('Неверный URL для мониторинга заказа.')?>
			<?php } ?>
		</div>
	</div>
</div>
