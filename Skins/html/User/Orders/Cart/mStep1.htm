<?php echo CssCopmress::load('cart')?>

<div id="title" class="title">
  <div class="">
    <div class=" clearfix">
      <!-- Хлебные крошки -->
      <nav class="text-sm text-gray-500 flex flex-wrap items-center gap-1 mb-6 ">
        <?php if(count($breadcrumbs)) { ?>
        <?php $bcLast = array_pop($breadcrumbs); ?>
        <?php $position = 0; ?>
        <?php foreach($breadcrumbs as $bc) { ?>
        <?php $position++; ?>
        <a href="<?php echo $bc['url']; ?>" class="hover:text-gray-700">
          <?php echo $bc['name']; ?>
        </a>
        <span class="mx-1">›</span>
        <?php } ?>
        <span class="text-gray-700"><?php echo $bcLast['name']; ?></span>
        <?php } ?>
      </nav>


      <?php if(trim($pageInf['header'])) { ?>
      <h1 class="pagetitle text-3xl font-semibold mb-6"><?php echo $pageInf['header']; ?></h1>
      <?php } ?>
    </div>
  </div>
</div>
<div id="content" class="content">
  <div class="">
    <div class="clearfix">
      <?php if(trim($pageInf['text']) !== '') { ?>
      <?php echo ($pageInf['seo_hide'] ? Url_SeoHide::parse($pageInf['text']) : $pageInf['text'])?>
      <div class="cl"></div>
      <?php } ?>

      <div class="order_form_div someform orderforma order-checkout">
        <form action="<?php echo Url::a('catalog-cart')?>" method="get" class="cart-table-form" style="width: 100%;">
          <?php /* Это здесь для того, чтобы по нажатии Enter запускался пересчёт формы (основное действиие), а не очистка */?>
          <div style="display: none"><input type="submit" name="recalc" value="1"></div>

          <div class="section summary">
            <h4 class="font-black text-2xl">Ваш заказ</h4>
            <div class="body">
              <table class="products js-element w-full border-collapse">
                <thead>
                <tr class="bg-gray-50 text-left text-sm font-medium text-gray-600">
                  <th class="item nowrap px-4 py-3">Серия</th>
                  <th class="custom nowrap px-4 py-3">Товар</th>
                  <th class="custom nowrap px-4 py-3">Цвет</th>
                  <th class="custom nowrap px-4 py-3">Кол-во</th>
                  <th class="custom nowrap px-4 py-3">Цена</th>
                  <th class="custom nowrap px-4 py-3">Сумма</th>
                  <th class="custom nowrap w-1 whitespace-nowrap px-1 py-3"></th>
                </tr>
                </thead>
                <tbody>
                <?php foreach($cart as $c) { ?>
                <tr class="border-t border-gray-200 hover:bg-gray-50 transition">
                  <!-- Серия -->
                  <td class="item px-4 py-3">
                    <?php if($c['series']) { ?>
                    <a href="<?php echo Catalog_Series::a($c['series'])?>" class="text-blue-600 hover:text-blue-800">
                      <?php echo $c['series']['name']; ?>
                    </a>
                    <?php } ?>
                  </td>

                  <!-- Товар (изображение + название + артикул + размер) -->
                  <td class="itemname px-4 py-3">
                    <div class="flex items-start gap-3">
                      <!-- Изображение -->
                      <div class="flex-shrink-0">
                        <?php if($c['item']['_img_ext']) { ?>
                        <img
                          src="<?php echo Catalog::photoUrl(
                    Catalog_Items::$imagePath,
                    $c['item']['id'], 60, 60, 1, $c['item']['_img_ext'],
                    $c['item']['image-name']
                  )?>"
                          alt="<?php echo hsch($c['item']['name']); ?>"
                          class="w-12 h-12 object-cover rounded"
                        />
                        <?php } else { ?>
                        <div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 11a1 1 0 011-1h14a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6z" />
                          </svg>
                        </div>
                        <?php } ?>
                      </div>

                      <!-- Текст -->
                      <div class="min-w-0">
                        <div class="font-medium text-gray-900"><?php echo $c['item']['name']; ?></div>
                        <div class="text-xs text-gray-500 mt-1">
                          Арт.: <?php echo $c['item']['art']; ?><br>
                          <?php if(trim($c['item']['size']) !== '') { ?>
                          Размер: <?php echo $c['item']['size']; ?>
                          <?php } ?>
                        </div>
                      </div>
                    </div>
                  </td>

                  <!-- Цвет -->
                  <td class="material !flex flex-col justify-center px-4 py-3" style="min-width: 100px;">
                    <?php if($c['material']) { ?>
                    <?php if($c['material']['_img_ext']) { ?>
                    <div class="flex justify-center items-center gap-2">
                      <a
                        href="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $c['material']['id']; ?>.<?php echo $c['material']['_img_ext']; ?>"
                        target="_blank"
                        onclick="return hs.expand(this, {slideshowGroup: 'default'})"
                        class="block"
                      >
                        <img
                          src="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $c['material']['id']; ?>_24x24_0.<?php echo $c['material']['_img_ext']; ?>"
                          width="24"
                          height="24"
                          alt="<?php echo hsch(implode(' / ', Catalog_Materials::getFullName($c['material']['id'])))?>"
                          class="rounded border"
                        />
                      </a>
                      <?php } ?>
                      <div class="name">
                        <?php echo implode('<br>', Catalog_Materials::getFullName($c['material']['id']))?>
                      </div>
                      <?php } else { ?>
                    </div>                                        &nbsp;
                    <?php } ?>
                  </td>

                  <!-- Количество -->
                  <td class="nowrap px-4 py-3" style="width: 128px;">
          <span class="quantity !flex items-center gap-2">
            <a
              class="minus w-8 h-8 !flex items-center justify-center border border-gray-300 rounded text-gray-600 hover:bg-gray-100"
              href="javascript:void(0)"
              onclick="oCart.amountMinus(this, true); return false;"
            >–</a>
            <input
              type="text"
              name="amount[<?php echo intval($c['item']['id'])?>][<?php echo intval($c['material']['id']); ?>]"
              value="<?php echo $c['amount']; ?>"
              class="w-12 text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <span class="js-measurename text-xs text-gray-500">шт</span>
            <a
              class="plus w-8 h-8 !flex items-center justify-center border border-gray-300 rounded text-gray-600 hover:bg-gray-100"
              href="javascript:void(0)"
              onclick="oCart.amountPlus(this); return false;"
            >+</a>
          </span>
                  </td>

                  <!-- Цена -->
                  <td class="nowrap right px-4 py-3">
                    <?php if(abs($c['price'])): ?>
                    <!-- Старая цена (если есть скидка) -->
                    <?php if (abs($c['item']['discount']) != 1 && $c['item']['discount'] > 0.0001): ?>
                    <div class="text-xs text-gray-500 line-through">
                      <?php echo Catalog::priceFormat($c['price'] / $c['item']['discount']); ?> руб.
                    </div>
                    <?php endif; ?>
                    <!-- Текущая цена -->
                    <div class="font-medium">
                      <?php echo Catalog::priceFormat($c['price']); ?> руб.
                    </div>
                    <?php else: ?>
                    <div class="text-gray-500">по запросу</div>
                    <?php endif; ?>
                  </td>

                  <!-- Сумма -->
                  <td class="nowrap right px-4 py-3">
                    <div class="font-medium">
                      <?php echo Catalog::priceFormat($c['price'] * $c['amount'])?> руб.
                    </div>
                  </td>

                  <!-- Удалить -->
                  <td class="w-1 whitespace-nowrap px-1 py-3 text-center">
                    <a
                      href="<?php echo Url::a('catalog-cart')?>?remove=<?php echo intval($c['item']['id'])?>&amp;material_id=<?php echo intval($c['material']['id'])?>"
                      class="text-red-600 hover:text-red-800 text-xl leading-none no-underline hover:no-underline"
                      aria-label="Удалить товар"
                    >×</a>
                  </td>
                </tr>
                <?php } ?>

                <!-- Пересчитать -->
                <tr class="no-borders border-t border-gray-200">
                  <td colspan="4" class="px-4 py-3"></td>
                  <td class="px-4 py-3">
                    <button type="submit" name="recalc" value="1" class="px-4 py-2 bg-main text-white rounded-md hover:bg-main_hover transition font-medium">
                      пересчитать
                    </button>
                  </td>
                  <td class="px-4 py-3"></td>
                </tr>
                </tbody>
              </table>
              <div class="order_pay">
                <div class="right">
                  <table class="bx_ordercart_order_sum">
                    <tr>
                      <td class="custom_t1 fwb" colspan="6" class="itog">
                        Итого:
                      </td>
                      <td class="custom_t2 fwb price">
                        <?php echo Catalog::priceFormat($totalPrice)?>
                        руб.
                      </td>
                    </tr>
                    <?php if($totalPriceOld) { ?>
                    <tr>
                      <td class="custom_t1" colspan="6"></td>
                      <td class="custom_t2" style="text-decoration:line-through; color:#828282;">
                        <?php echo Catalog::priceFormat(round($totalPriceOld))?>
                        руб.
                      </td>
                    </tr>
                    <?php } ?>
                  </table>
                </div>
              </div>
            </div>
            <div class="h4 clearfix">
              <a class="btn btn1 orderbtn !bg-main" href="<?php echo Url::a('catalog-cart')?>?clear=1" onclick="return window.confirm('Вы действительно хотите удалить все товары из корзины?')">
                очистить корзину
              </a>
            </div>
          </div>
        </form>
        <br><br>

        <div class="clearfix flex flex-col lg:flex-row gap-6 lg:gap-8">
          <!-- Форма "Заявка в 1 клик" -->
          <form
            action="<?php echo Url::a('catalog-cart-oneclick')?>"
            method="post"
            class="form cart-step1-left flex-1 w-full"
            id="cart-form2"
          >
            <h4 class="text-center font-medium text-2xl mb-6">Заявка в 1 клик</h4>
            <div class="body clearfix space-y-4">
              <div class="line f_text" data-type="TEXT">
                <div class="vl">
                  <input
                    type="text"
                    name="quick[fio]"
                    value="<?php echo $userInf['fio']; ?>"
                    placeholder="Контактное лицо *"
                    maxlength="1000"
                    required
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                </div>
              </div>
              <div class="line f_text" data-type="TEXT">
                <div class="vl">
                  <input
                    class="maskPhone w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    type="text"
                    name="quick[phone]"
                    value="<?php echo $userInf['phone']; ?>"
                    placeholder="Телефон *"
                    maxlength="30"
                    required
                  >
                </div>
              </div>
              <div class="flex justify-center mt-4">
                <button
                  onclick="yaCounter19019251.reachGoal('zakaz_1click_korzina'); return true;"
                  type="submit"
                  class="btn btn1 orderbtn !bg-main px-8 py-3 text-white font-medium rounded-md hover:bg-opacity-90 transition"
                >
                  Оформить
                </button>
              </div>
            </div>
          </form>

          <!-- Форма "Заявка с реквизитами" -->
          <form
            method="post"
            class="form cart-step1-right flex-1 w-full"
            id="cart-form1"
          >
            <h4 class="text-center font-medium text-2xl mb-6">Заявка с реквизитами</h4>
            <div class="body clearfix space-y-4">
              <div class="line f_text" data-type="TEXT">
                <div class="vl">
                  <input
                    type="text"
                    name="user[fio]"
                    placeholder="Контактное лицо *"
                    maxlength="1000"
                    msg_maxlen="Контактное лицо не должно превышать 1000 символов"
                    required
                    msg_required="Вы не ввели Контактное лицо"
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                </div>
              </div>
              <div class="line f_text" data-type="TEXT">
                <div class="vl">
                  <input
                    class="maskPhone w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    type="text"
                    name="user[phone]"
                    placeholder="Телефон *"
                    maxlength="30"
                    msg_maxlen="Номер телефона не должен превышать 30 символов"
                    required
                    msg_required="Вы не ввели контактный телефон"
                  >
                </div>
              </div>
              <div class="line f_text" data-type="TEXT">
                <div class="vl">
                  <input
                    type="email"
                    name="user[email]"
                    placeholder="E-Mail *"
                    maxlength="1000"
                    msg_maxlen="E-mail не должен превышать 1000 символов"
                    required
                    msg_required="Вы не ввели ваш E-mail"
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                </div>
              </div>
              <div class="line f_text" data-type="TEXT">
                <div class="vl">
                  <input
                    type="text"
                    name="user[city]"
                    placeholder="Город *"
                    maxlength="100"
                    msg_maxlen="Название города не должно превышать 100 символов"
                    required
                    msg_required="Вы не ввели ваш город"
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                </div>
              </div>
              <div class="line f_text" data-type="TEXT">
                <div class="vl">
                  <input
                    type="text"
                    name="user[address]"
                    placeholder="Адрес доставки *"
                    maxlength="1000"
                    msg_maxlen="Адрес доставки не должен превышать 1000 символов"
                    required
                    msg_required="Вы не ввели адрес доставки"
                    class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                </div>
              </div>
              <div class="line f_textarea" data-type="TEXTAREA">
                <div class="vl">
          <textarea
            rows="2"
            name="user[info]"
            placeholder="Комментарий к заказу"
            style="min-height: 120px;"
            maxlength="5000"
            msg_maxlen="Комментарий к заказу не должен превышать 5000 символов"
            class="w-full px-4 py-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
          ></textarea>
                </div>
              </div>

              <!-- Итоговая сумма и кнопка -->
              <div class="order-total clearfix pt-4 border-t border-gray-200">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                  <div>
                    <span class="text-gray-600">Сумма заказа:</span>
                    <strong class="ml-1 text-lg"><?php echo Catalog::priceFormat($totalPrice)?> руб.</strong>
                    <?php if($totalPriceOld): ?>
                    <div class="text-sm text-gray-500 line-through">
                      Было: <?php echo Catalog::priceFormat(round($totalPriceOld))?> руб.
                    </div>
                    <?php endif; ?>
                  </div>
                  <div>
                    <button
                      type="submit"
                      class="btn btn1 orderbtn !bg-main px-6 py-3 text-white font-medium rounded-md hover:bg-opacity-90 transition"
                    >
                      Продолжить оформление
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>
</div>
