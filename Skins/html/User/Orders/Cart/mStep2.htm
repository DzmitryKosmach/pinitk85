<?php echo CssCopmress::load('cart'); ?>
<script>
  oCart.totalPrice = <?php echo $totalPrice?>;
</script>

<div id="title" class="title">
  <div class="max-w-1440 mx-auto px-4 sm:px-6 lg:px-8 py-4">
    <div class="centeringin clearfix flex flex-col gap-3">
      <?php if(count($breadcrumbs)) { ?>
      <?php $bcLast = array_pop($breadcrumbs); ?>
      <ul class="breadcrumb flex flex-wrap items-center gap-1 text-sm text-gray-500" itemscope itemtype="http://schema.org/BreadcrumbList">
        <?php $position = 0; ?>
        <?php foreach($breadcrumbs as $bc) { ?>
        <?php $position = $position + 1 ?>
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="<?php echo $bc['url']; ?>" title="<?php echo hsch($bc['name']); ?>" itemscope itemtype="http://schema.org/Thing"
             itemid="<?php echo $bc['url']; ?>"
             itemprop="item"><span itemprop="name"><?php echo $bc['name']; ?></span></a>
          <meta itemprop="position" content="<?php echo $position?>" />
        </li>
        <li><span> / </span></li>
        <?php } ?>
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<span itemscope itemtype="http://schema.org/Thing" itemid="<?php echo $bc['url']; ?>" itemprop="item">
							<span itemprop="name"><?php echo $bcLast['name']; ?></span>
						</span>
          <meta itemprop="position" content="<?php echo $position + 1?>" />
        </li>
      </ul>
      <?php } ?>
      <?php if(trim($pageInf['header'])) { ?>
      <h1 class="pagetitle text-2xl md:text-3xl font-semibold"><?php echo $pageInf['header']; ?></h1>
      <?php } ?>
    </div>
  </div>
</div>
<div id="content" class="content">
  <div class="max-w-1440 mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="centeringin clearfix">
      <?php if(trim($pageInf['text']) !== '') { ?>
      <?php echo ($pageInf['seo_hide'] ? Url_SeoHide::parse($pageInf['text']) : $pageInf['text']); ?>
      <div class="cl"></div>
      <?php } ?>

      <div class="order_form_div someform orderforma order-checkout">
        <div class="clearfix flex flex-col lg:flex-row gap-6">
          <form action="<?php echo Url::a('catalog-cart'); ?>" method="post" class="cart-step2-left form flex-1 w-full" style="width: 100%;">
            <h4 class="text-2xl font-semibold mb-4">Опции заказа</h4>
            <div class="body clearfix" id="cart-options">
              <div class="persontypes clearfix">
							<span class="subtitle block text-gray-700 mb-2">
									Доставка:
									<span id="delivery-price">
										<?php echo Catalog::priceFormat($optionsPrices[Orders_Options::DELIVERY]['price']); ?>
									</span>
									руб.
								</span>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::DELIVERY?>]" id="delivery-0"
                         value="<?php echo Orders_Options::DELIVERY_NO?>"
                  <?php if($totalPrice < Orders_Options::pickupMinSum()) { ?>disabled<?php } ?>
                  onchange="oCart.calcOptions()">
                  <label for="delivery-0" class="text-gray-700">самовывоз</label>
                </div>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::DELIVERY?>]" id="delivery-1"
                         value="<?php echo Orders_Options::DELIVERY_MSK?>"
                         onchange="oCart.calcOptions()">
                  <label for="delivery-1" class="text-gray-700">по Москве</label>
                </div>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::DELIVERY?>]" id="delivery-2"
                         value="<?php echo Orders_Options::DELIVERY_OUTMSK?>"
                         onchange="oCart.calcOptions()">
                  <label for="delivery-2" class="text-gray-700">за МКАД</label>
                </div>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::DELIVERY?>]" id="delivery-3"
                         value="<?php echo Orders_Options::DELIVERY_TO_SHIPPING_COMPANY?>"
                         onchange="oCart.calcOptions()">
                  <label for="delivery-3" class="text-gray-700">до транспортной компании</label>
                </div>
              </div>
              <div class="line f_text" data-type="TEXT" id="delivery-distance-block">
                <div class="nm">
                  Расстояние
                </div>
                <div class="vl range-block flex items-center gap-3">
                  <div class="range-element flex-1">
                    <input type="range" id="delivery-distance-r" min="<?php echo Orders_Options::DELIVERY_DISTANCE_MIN?>" max="<?php echo Orders_Options::DELIVERY_DISTANCE_MAX?>" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500"><div class="min"><?php echo Orders_Options::DELIVERY_DISTANCE_MIN?></div><div class="max"><?php echo Orders_Options::DELIVERY_DISTANCE_MAX?></div></div>
                  </div>
                  <input type="text" name="options[<?php echo Orders_Options::DELIVERY_DISTANCE?>]" id="delivery-distance-t" class="text w-24 border border-gray-300 rounded px-2 py-1">
                  <div class="units text-gray-600">
                    &nbsp;км
                  </div>
                  <script>
                    onLoad(function(){
                      rangeInput(
                        $$$('delivery-distance-r'),
                        $$$('delivery-distance-t'),
                        function(){
                          oCart.calcOptions();
                        }
                      );
                    });
                  </script>
                </div>
              </div>

              <div class="persontypes clearfix">
							<span class="subtitle block text-gray-700 mb-2">
									Разгрузка:
									<span id="unloading-price">
										<?php echo Catalog::priceFormat($optionsPrices[Orders_Options::UNLOADING]['price']); ?>
									</span>
									руб.
								</span>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::UNLOADING?>]" id="unloading-0"
                         value="<?php echo Orders_Options::UNLOADING_NO?>"
                         onchange="oCart.calcOptions()"
                  >
                  <label for="unloading-0" class="text-gray-700">не нужна</label>
                </div>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::UNLOADING?>]" id="unloading-1"
                         value="<?php echo Orders_Options::UNLOADING_ELEVATOR?>"
                         onchange="oCart.calcOptions()"
                  >
                  <label for="unloading-1" class="text-gray-700">нужна, есть лифт</label>
                </div>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::UNLOADING?>]" id="unloading-2"
                         value="<?php echo Orders_Options::UNLOADING_STAIRS?>"
                         onchange="oCart.calcOptions()"
                  >
                  <label for="unloading-2" class="text-gray-700">нужна, нет лифта</label>
                </div>
              </div>
              <div class="line f_text" data-type="TEXT" id="unloading-floor-block">
                <div class="nm">
                  Этаж
                </div>
                <div class="vl range-block flex items-center gap-3">
                  <div class="range-element flex-1" >
                    <input type="range" id="unloading-floor-r" min="<?php echo Orders_Options::UNLOADING_FLOOR_MIN?>" max="<?php echo Orders_Options::UNLOADING_FLOOR_MAX?>" class="w-full">
                    <div class="flex justify-between text-xs text-gray-500"><div class="min"><?php echo Orders_Options::UNLOADING_FLOOR_MIN?></div><div class="max"><?php echo Orders_Options::UNLOADING_FLOOR_MAX?></div></div>
                  </div>
                  <input type="text" name="options[<?php echo Orders_Options::UNLOADING_FLOOR?>]" id="unloading-floor-t" class="text w-16 border border-gray-300 rounded px-2 py-1" value="1">
                  <div class="units text-gray-600">
                    &nbsp;эт
                  </div>
                  <script>
                    onLoad(function(){
                      rangeInput(
                        $$$('unloading-floor-r'),
                        $$$('unloading-floor-t'),
                        function(){
                          oCart.calcOptions();
                        }
                      );
                    });
                  </script>
                </div>
              </div>

              <div class="persontypes clearfix">
							<span class="subtitle block text-gray-700 mb-2">
									Сборка:
									<span id="assembly-price">
										<?php echo Catalog::priceFormat($optionsPrices[Orders_Options::ASSEMBLY]['price']); ?>
									</span>
									руб.
								</span>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::ASSEMBLY?>]" id="assembly-0"
                         value="<?php echo Orders_Options::ASSEMBLY_NO?>"
                         onchange="oCart.calcOptions()"
                  >
                  <label for="assembly-0" class="small text-gray-700">не нужна</label>
                </div>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::ASSEMBLY?>]" id="assembly-1"
                         value="<?php echo Orders_Options::ASSEMBLY_YES?>"
                         onchange="oCart.calcOptions()"
                  >
                  <label for="assembly-1" class="small text-gray-700">нужна</label>
                </div>
              </div>

              <div class="persontypes clearfix">
							<span class="subtitle block text-gray-700 mb-2">
									Вывоз мусора:
									<span id="garbage-price">
										<?php echo Catalog::priceFormat($optionsPrices[Orders_Options::GARBAGE]['price']); ?>
									</span>
									руб.<br>
									<span class="small">(до 10 куб.м. или 1500 кг)</span>
								</span>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::GARBAGE?>]" id="garbage-0"
                         value="<?php echo Orders_Options::GARBAGE_NO?>"
                         onchange="oCart.calcOptions()"
                  >
                  <label for="garbage-0" class="small text-gray-700">не нужен</label>
                </div>
                <div class="label left flex items-center gap-2 mt-2">
                  <input type="radio" class="accent-blue-600" name="options[<?php echo Orders_Options::GARBAGE?>]" id="garbage-1"
                         value="<?php echo Orders_Options::GARBAGE_YES?>"
                         onchange="oCart.calcOptions()"
                  >
                  <label for="garbage-1" class="small text-gray-700">нужен</label>
                </div>
              </div>
            </div>
            <div class="clearfix" id="options-calc-nojs">
              <button type="submit" class="btn btn1 orderbtn !bg-main px-4 py-2 text-white rounded-md hover:bg-opacity-90 transition" name="options-calc" value="1">
                рассчитать
              </button>
            </div>
          </form>
          <div class="cart-step2-right flex-1 w-full">
            <h4 class="text-2xl font-semibold mb-4">Итоговая стоимость</h4>
            <div class="body clearfix">
              <div class="order-total clearfix space-y-4">
                <div>
                  Сумма заказа:
                  <strong class="ml-1">
                    <?php echo Catalog::priceFormat($totalPrice); ?>
                    руб.
                  </strong>
                </div>
                <div>
                  Доставка/сборка:
                  <strong class="ml-1">
										<span id="options-price2">
											<?php
											echo Catalog::priceFormat(
												$optionsPrices[Orders_Options::DELIVERY]['price'] +
												$optionsPrices[Orders_Options::UNLOADING]['price'] +
												$optionsPrices[Orders_Options::ASSEMBLY]['price'] +
												$optionsPrices[Orders_Options::GARBAGE]['price']
											); ?>
										</span>
                    руб.
                  </strong>
                </div>
                <div class="clearfix">
                  <div class="price">
                    Итого:
                    <strong class="ml-1">
											<span id="total-price">
												<?php
												echo Catalog::priceFormat(
													$totalPrice +
													$optionsPrices[Orders_Options::DELIVERY]['price'] +
													$optionsPrices[Orders_Options::UNLOADING]['price'] +
													$optionsPrices[Orders_Options::ASSEMBLY]['price'] +
													$optionsPrices[Orders_Options::GARBAGE]['price']
												); ?>
											</span>
                      руб.
                    </strong>
                  </div>
                </div>

                <a href="<?php echo Url::a('catalog-cart-step3'); ?>" class="btn btn1">
                  Продолжить оформление заказа
                </a>
                <br><br>
                <a href="<?php echo Url::a('catalog-cart-step1'); ?>">
                  Вернуться к предыдущему этапу
                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="section summary">
          <h4>Товары в заказе</h4>
          <div class="body">
            <table class="products js-element">
              <tr>
                <th class="item nowrap">Серия</th>
                <th class="custom nowrap">Товар</th>
                <th class="custom nowrap">Цвет</th>
                <th class="custom nowrap">Цена</th>
                <th class="custom nowrap">Кол-во</th>
                <th class="custom nowrap">Сумма</th>
              </tr>
              <?php foreach($cart as $c) { ?>
              <tr>
                <td class="item">
                  <?php if($c['series']) { ?>
                  <a href="<?php echo Catalog_Series::a($c['series']); ?>"><?php echo $c['series']['name']; ?></a>
                  <?php } ?>
                </td>
                <td class="itemname">
                  <div class="pic">
                    <?php if($c['item']['_img_ext']) { ?>
                    <img
                      src="<?php echo Catalog::photoUrl(
														Catalog_Items::$imagePath,
														$c['item']['id'], 30, 30, 1, $c['item']['_img_ext'],
														$c['item']['image-name']
													); ?>"
                    >
                    <?php } ?>
                  </div>
                  <div class="text">
                    <?php echo $c['item']['name']; ?><br>
                    <span>
												Арт.: <?php echo $c['item']['art']; ?><br>
                      <?php if(trim($c['item']['size']) !== '') { ?>
                      Размер: <?php echo $c['item']['size']; ?>
                      <?php } ?>
											</span>
                  </div>
                </td>
                <td class="material" style="min-width: 100px;">
                  <?php if($c['material']) { ?>
                  <?php if($c['material']['_img_ext']) { ?>
                  <div class="image">
                    <a href="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $c['material']['id']; ?>.<?php echo $c['material']['_img_ext']; ?>" target="_blank" onclick="return hs.expand(this, {slideshowGroup: 'default'})">
                      <img src="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $c['material']['id']; ?>_24x24_0.<?php echo $c['material']['_img_ext']; ?>" width="24" height="24" alt="<?php echo hsch(implode(' / ', Catalog_Materials::getFullName($c['material']['id']))); ?>">
                    </a>
                  </div>
                  <?php } ?>
                  <div class="name">
                    <?php echo implode('<br>', Catalog_Materials::getFullName($c['material']['id'])); ?>
                  </div>
                  <?php } else { ?>
                  &nbsp;
                  <?php } ?>
                </td>
                <td class="nowrap right">
                  <?php if(abs($c['price'])) { ?>
                  <?php echo Catalog::priceFormat($c['price']); ?>
                  руб.
                  <?php if(abs($c['item']['discount']) != 1) { ?>
                  <?php $d = Catalog::num2percent($c['item']['discount'], Catalog::PC_DECREASE); ?>
                  <br>
                  <span class="discount" title="Цена со скидкой <?php echo $d?>%">
													(-<?php echo $d; ?>%)
												</span>
                  <?php } ?>
                  <?php } else { ?>
                  по запросу
                  <?php } ?>
                </td>
                <td class="nowrap right">
                  <?php echo $c['amount']; ?>
                  шт
                </td>
                <td class="nowrap right">
                  <?php echo Catalog::priceFormat($c['price'] * $c['amount']); ?>
                  руб.
                </td>
              </tr>
              <?php } ?>
            </table>
            <div class="order_pay">
              <div class="right">
                <table class="bx_ordercart_order_sum">
                  <tr>
                    <td class="custom_t1 fwb" colspan="6" class="itog">
                      Итого:
                    </td>
                    <td class="custom_t2 fwb price">
                      <?php echo Catalog::priceFormat($totalPrice); ?>
                      руб.
                    </td>
                  </tr>
                  <tr>
                    <td class="custom_t1" colspan="6"></td>
                    <td class="custom_t2">
                      <?php echo $totalAmount; ?> шт.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
