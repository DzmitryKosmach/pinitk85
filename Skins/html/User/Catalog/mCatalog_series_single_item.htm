<?php echo CssCopmress::load('catalog')?>
<?php echo CssCopmress::load('series')?>

<?php echo JsCopmress::load('catalog')?>
<?php echo JsCopmress::load('series')?>
<script>
    oMaterials.tree = AJAX.jsonDecode('<?php echo str_replace('\'', '\\\'', toJson($materials))?>');
</script>

<div id="title" class="title">
    <div>
        <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
        <nav class="text-sm text-gray-500 flex flex-wrap items-center gap-1 mb-10">
            <?php if(count($breadcrumbs)) { ?>
            <?php $bcLast = array_pop($breadcrumbs); ?>
            <?php $position = 0; ?>
            <?php foreach($breadcrumbs as $bc) { ?>
            <?php $position = $position + 1; ?>
            <a href="<?php echo $bc['url']; ?>" class="hover:text-gray-700">
                <?php echo $bc['name']; ?>
            </a>
            <span class="mx-1">‚Ä∫</span>
            <?php } ?>
            <span class="text-gray-700">
                    <?php echo $bcLast['name']; ?>
                </span>
            <?php } ?>
        </nav>

        <!-- –ë–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ (md) -->
        <div class="md:hidden block">
            <div class="flex items-center justify-between">
                <div class="flex gap-4 items-center mt-auto text-gray-500 text-sm mb-3">
                    <button class="hover:opacity-50">
                        <img src="/images/index/izbr_small.png" </button>
                    <button class="hover:opacity-50">
                        <img src="/images/index/srav_small.png" </button>
                </div>
                <div class="flex gap-4 items-center mt-auto text-gray-500 text-sm mb-3">
                    <button class="hover:opacity-50">&lt; –ü—Ä–µ–¥.—Ç–æ–≤–∞—Ä</button>
                    <button class="hover:opacity-50">–°–ª–µ–¥.—Ç–æ–≤–∞—Ä &gt;</button>
                </div>
            </div>

            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
            <h1 class="text-2xl font-bold leading-snug mb-3">
                <?php echo $seriesInf['name']; ?><br class="hidden md:inline" />
                <!--          <?php echo $pageInf['header']; ?>-->
            </h1>

        </div>
    </div>
</div>

<div id="content" class="content">
    <div>
        <div>
            <div class="flex flex-col sm2:flex-row gap-12 js-element js-elementid<?php echo $seriesInf['id']; ?> offers propvision1 clearfix" data-elementid="<?php echo $seriesInf['id']; ?>" data-elementname="<?php echo hsch($seriesInf['name']); ?>">
                <?php if(count($photos)) { ?>
                <div class="pictures sm2:w-1/2 changegenimage">
                    <div class="flex lg:flex-row flex-col-reverse gap-4">

                        <!-- –ì–∞–ª–µ—Ä–µ—è –º–∏–Ω–∏–∞—Ç—é—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ -->
                        <div class="slider-thumbnails-container">
                            <div class="flex flex-row lg:flex-col justify-center items-center gap-2 max-h-[500px] overflow-hidden">
                                <!-- –ö–Ω–æ–ø–∫–∞ "–≤–≤–µ—Ä—Ö / –≤–ª–µ–≤–æ" -->
                                <button type="button"
                                        class="slider-prev text-gray-600 hover:text-black focus:outline-none"
                                        aria-label="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 rotate-[-90deg] lg:rotate-0"
                                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M5 15l7-7 7 7" />
                                    </svg>
                                </button>

                                <!-- –°–ª–∞–π–¥–µ—Ä –º–∏–Ω–∏–∞—Ç—é—Ä -->
                                <div class="slider-track flex flex-row lg:flex-col gap-2 overflow-x-auto lg:overflow-y-auto max-h-full max-w-full lg:max-w-[80px] scroll-smooth snap-x snap-mandatory lg:snap-y scrollbar-none"
                                     style="scroll-behavior: smooth; -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory;">
                                    <?php foreach($photos as $pn => $p): ?>
                                    <img
                                            src="<?php echo Catalog::photoUrl(Catalog_Series_Photos::$imagePath, $p['id'], 90, 90, $p['rm'], $p['_img_ext']); ?>"
                                            data-bigimage="<?php echo Catalog::photoUrl(Catalog_Series_Photos::$imagePath, $p['id'], 0, 0, 0, $p['_img_ext']); ?>"
                                            alt="<?php echo hsch($p['alt'] ?: $catInf['name'] . ' ' . $seriesInf['name'] . ($pn > 0 ? ' - —Ñ–æ—Ç–æ ' . ($pn + 1) : '')); ?>"
                                            title="<?php echo hsch($p['alt'] ?: $catInf['name'] . ' ' . $seriesInf['name'] . ($pn > 0 ? ' - —Ñ–æ—Ç–æ ' . ($pn + 1) : '')); ?>"
                                            class="w-20 h-20 object-cover rounded border flex-shrink-0 snap-start cursor-pointer transition-transform hover:scale-105"
                                            onclick="changeMainImage(this)"
                                    />
                                    <?php endforeach; ?>
                                </div>

                                <!-- –ö–Ω–æ–ø–∫–∞ "–≤–Ω–∏–∑ / –≤–ø—Ä–∞–≤–æ" -->
                                <button type="button"
                                        class="slider-next text-gray-600 hover:text-black focus:outline-none"
                                        aria-label="–°–ª–µ–¥—É—é—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 rotate-90 lg:rotate-180"
                                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M5 15l7-7 7 7" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
                        <div class="pic w-full relative">
                        <?php if(intval($seriesInf['out_of_production'])) { ?>
                        <div class="out-of-production">
                            <div>–°–Ω—è—Ç–æ —Å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</div>
                        </div>
                        <?php } ?>
                        <div class="glass w-full aspect-[578/409] rounded-xl object-cover cursor-zoom-in">
                            <?php
                                $p = $photos[0];
                                ?>
                            <img class="js_picture_glass genimage"
                                 src="<?php echo Catalog::photoUrl(
										 Catalog_Series_Photos::$imagePath,
										 $p['id'], 0, 0, 0, $p['_img_ext']
									 )?>"
                                 alt="<?php echo hsch($p['alt'] ? $p['alt'] : $catInf['name'] . ' ' . $seriesInf['name']); ?>"
                                 title="<?php echo hsch($p['alt'] ? $p['alt'] : $catInf['name'] . ' ' . $seriesInf['name']); ?>"
                            >
                            <?php /*<div class="glass_lupa"></div>*/?>

                        <?php
                                    if(is_array($seriesSet) && count($seriesSet)) {
                                    ?>
                        <div class="series-set-points" id="series-set-points">
                            <?php foreach($seriesSet as $in => $i) { ?>
                            <?php if(!$i['on_series_photo']) continue; ?>
                            <div
                                    id="series-set-point-<?php echo $i['id']; ?>"
                                    style="left: <?php echo round(100*$i['on_series_photo_x']/Catalog_Series_SetItems::SET_IMAGE_DEFAULT_W, 4)?>%; top: <?php echo round(100*$i['on_series_photo_y']/Catalog_Series_SetItems::SET_IMAGE_DEFAULT_H, 4)?>%;"
                                    onclick="showItemPopup2('<?php echo Catalog_Items::a($seriesInf, $i); ?>', <?php echo $i['id']; ?>); return false;"
                                    onmouseover="seriesSetHoverPoint(<?php echo $i['id']?>, true)"
                                    onmouseout="seriesSetHoverPoint(<?php echo $i['id']?>, false)"
                            >
                                <span <?php if($i['on_series_photo_x'] >= 400) { ?>class="title-left"<?php } ?>>
                                <?php echo $i['name']?> <?php echo $i['art']; ?><?php if(trim($i['size']) !== '') { ?> (<?php echo $i['size']; ?>)<?php } ?>
                                </span>
                            </div>
                            <?php } ?>
                        </div>
                        <?php }  ?>
                    </div>
                  </div>
                </div>

                <div class="fancyimages noned" title="<?php echo hsch($seriesInf['name']); ?>">
                    <div class="fancygallery">
                        <table class="changegenimage">
                            <tbody>
                            <tr>
                                <td class="image">
                                    <?php
											$p = $photos[0];
											?>
                                    <img class="max genimage"
                                         src="<?php
                                                 echo Catalog::photoUrl(
													 Catalog_Series_Photos::$imagePath,
													 $p['id'], 0, 0, 0, $p['_img_ext'], [$catInf['url'], $seriesInf['url']]
												 );?>"
                                         alt="<?php echo hsch($p['alt'] ? $p['alt'] : $catInf['name'] . ' ' . $seriesInf['name']); ?>"
                                         title="<?php echo hsch($p['alt'] ? $p['alt'] : $catInf['name'] . ' ' . $seriesInf['name']); ?>">
                                </td>
                                <td class="slider">
                                    <div class="picslider scrollp vertical">
                                        <a rel="nofollow" class="scrollbtn prev pop" href="#">
                                            <i class="icon pngicons"></i>
                                        </a>
                                        <div class="popd_jscrollpane scroll vertical-only max" id="d_scroll_popup_<?php echo $seriesInf['id']; ?>">
                                            <div class="scrollinner">
                                                <?php foreach($photos as $pn => $p) { ?>
                                                <a rel="nofollow" class="changeimage scrollitem imgoffer imgofferid<?php echo $p['id']; ?>" href="#">
                                                    <img
                                                            src="<?php echo Catalog::photoUrl(
																		Catalog_Series_Photos::$imagePath,
																		$p['id'], 90, 90, $p['rm'], $p['_img_ext']
																	); ?>"
                                                            alt="<?php echo hsch($p['alt'] ? $p['alt'] : $catInf['name'] . ' ' . $seriesInf['name'] . ($pn > 0 ? ' - —Ñ–æ—Ç–æ' . ($pn+1) : '')); ?>"
                                                            title="<?php echo hsch($p['alt'] ? $p['alt'] : $catInf['name'] . ' ' . $seriesInf['name'] . ($pn > 0 ? ' - —Ñ–æ—Ç–æ' . ($pn+1) : '')); ?>"
                                                            data-bigimage="<?php
                                                                    echo Catalog::photoUrl(
																		Catalog_Series_Photos::$imagePath,
																		$p['id'], 0, 0, 0, $p['_img_ext'],
                                                                        [$catInf['url'], $seriesInf['url']]
																	); ?>">
                                                </a>
                                                <?php } ?>
                                            </div>
                                        </div>
                                        <a rel="nofollow" class="scrollbtn next pop" href="#">
                                            <i class="icon pngicons"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥ –≥–∞–ª–µ—Ä–µ–µ–π -->
                <div class="bg-white py-4 px-8 rounded-lg shadow-md mt-10" id="series-block">
                    <div class="relative">
                        <div id="series-text">
                            <p class="text-lg leading-6 overflow-hidden transition-all duration-300">
                                <?php echo $seriesInf['text']; ?>
                            </p>
                        </div>

                        <!-- –ì—Ä–∞–¥–∏–µ–Ω—Ç -->
                        <div id="fade-gradient"
                             class="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-white to-transparent pointer-events-none hidden"></div>

                        <a id="read-more-btn"
                           class="inline-block text-gray-600 mt-2 cursor-pointer hidden relative z-10">
                            –ß–∏—Ç–∞—Ç—å –≤—Å–µ
                        </a>
                    </div>
                </div>

                <script>
                    // –ß–∏—Ç–∞—Ç—å –≤—Å–µ
                    document.addEventListener('DOMContentLoaded', () => {
                        const text = document.getElementById('series-text');
                        const btn = document.getElementById('read-more-btn');
                        const gradient = document.getElementById('fade-gradient');
                        const block = document.getElementById('series-block');

                        if (!text) return;

                        const maxLines = 3;
                        let maxHeight = 0;

                        const updateHeights = () => {
                            const computed = window.getComputedStyle(text);
                            let lineHeight = parseFloat(computed.lineHeight);

                            if (isNaN(lineHeight)) {
                                const tempSpan = document.createElement('span');
                                tempSpan.style.visibility = 'hidden';
                                tempSpan.style.font = computed.font;
                                tempSpan.textContent = 'Hg';
                                document.body.appendChild(tempSpan);
                                const rect = tempSpan.getBoundingClientRect();
                                lineHeight = rect.height;
                                document.body.removeChild(tempSpan);
                            }

                            maxHeight = lineHeight * maxLines;
                            return maxHeight;
                        };

                        const checkTruncation = () => {
                            updateHeights();
                            setTimeout(() => {
                                const realHeight = text.scrollHeight;
                                if (realHeight > maxHeight) {
                                    text.style.maxHeight = maxHeight + 'px';
                                    text.style.overflow = 'hidden';
                                    btn.classList.remove('hidden');
                                    gradient.classList.remove('hidden');
                                }
                            }, 0);
                        };

                        checkTruncation();

                        // –ö–Ω–æ–ø–∫–∞
                        btn.addEventListener('click', () => {
                            if (text.style.maxHeight && text.style.maxHeight !== 'none') {
                                // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
                                text.style.maxHeight = 'none';
                                btn.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
                                gradient.classList.add('hidden');
                            } else {
                                // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º
                                text.style.maxHeight = maxHeight + 'px';
                                btn.textContent = '–ß–∏—Ç–∞—Ç—å –≤—Å–µ';
                                gradient.classList.remove('hidden');

                                // –°–∫—Ä–æ–ª–ª–∏–º —Å –æ—Ç—Å—Ç—É–ø–æ–º 80px –æ—Ç –≤–µ—Ä—Ö–∞
                                const top = block.getBoundingClientRect().top + window.scrollY - 80;
                                window.scrollTo({ top, behavior: 'smooth' });
                            }
                        });
                    });
                </script>
            </div>
            <!-- JavaScript –¥–ª—è —Å–º–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
            <script>
                // –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                function changeMainImage(thumb) {
                    const mainImg = document.getElementById('main-product-image');
                    const infoDots = document.getElementById('infoDots'); // –∏–ª–∏ 'series-set-points', –µ—Å–ª–∏ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è
                    const bigImage = thumb.dataset.bigimage;
                    const alt = thumb.alt;

                    // –ú–µ–Ω—è–µ–º –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    if (mainImg && bigImage) {
                        mainImg.src = bigImage;
                        mainImg.alt = alt;
                    }

                    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–∏–Ω–∏–∞—Ç—é—Ä—ã
                    const thumbnails = document.querySelectorAll('.slider-track img');

                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–π –º–∏–Ω–∏–∞—Ç—é—Ä—ã
                    const thumbIndex = Array.from(thumbnails).indexOf(thumb);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–∫–∏ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –º–∏–Ω–∏–∞—Ç—é—Ä–∞
                    if (thumbIndex === 0) {
                        infoDots.classList.remove('hidden'); // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
                    } else {
                        infoDots.classList.add('hidden');    // —Å–∫—Ä—ã–≤–∞–µ–º
                    }

                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –º–∏–Ω–∏–∞—Ç—é—Ä—ã
                    thumbnails.forEach(img => {
                        img.classList.remove('border-blue-600');
                    });
                    thumb.classList.add('border-blue-600');
                }

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                document.addEventListener('DOMContentLoaded', function () {
                    const firstThumb = document.querySelector('.slider-track img');
                    if (firstThumb) {
                        changeMainImage(firstThumb);
                    }

                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –º–∏–Ω–∏–∞—Ç—é—Ä –ø—Ä–∏ –∫–ª–∏–∫–µ
                    document.querySelectorAll('.slider-track img').forEach(img => {
                        img.addEventListener('click', function () {
                            changeMainImage(this);
                        });
                    });

                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è fancybox –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    // if (typeof $.fancybox !== 'undefined') {
                    //   $('[data-fancybox]').fancybox({
                    //     animationEffect: "zoom",
                    //     transitionEffect: "slide",
                    //     buttons: ["close"],
                    //     thumbs: { autoStart: true },
                    //     loop: true,
                    //     clickContent: false
                    //   });
                    // }
                });

                // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ—Ç—ã —Å–ª–∞–π–¥–µ—Ä–∞ –º–∏–Ω–∏–∞—Ç—é—Ä
                function updateThumbnailSliderHeight() {
                    // üîπ –ü—Ä–æ–≤–µ—Ä—è–µ–º —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞
                    if (window.innerWidth < 1024) {
                        // –ù–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ–º
                        const track = document.querySelector('.slider-track');
                        const container = document.querySelector('.slider-thumbnails-container');

                        if (track) {
                            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏, –∑–∞–¥–∞–Ω–Ω—ã–µ JS
                            track.style.maxHeight = '';
                            track.style.height = '';
                        }
                        if (container) {
                            container.style.height = '';
                            container.style.maxHeight = '';
                        }

                        // –í—Å—ë —Ä–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–∑-–∑–∞ —Ä–µ—Å–∞–π–∑–∞)
                        updateButtons();
                        return;
                    }

                    // üîπ –ù–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö ‚Äî –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–¥ –≤—ã—Å–æ—Ç—É –≥–ª–∞–≤–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    const mainImage = document.querySelector('.w-full > img');
                    const container = document.querySelector('.slider-thumbnails-container');
                    const track = container?.querySelector('.slider-track');
                    const btnPrev = container?.querySelector('.slider-prev');
                    const btnNext = container?.querySelector('.slider-next');

                    if (!mainImage || !container || !track || !btnPrev || !btnNext) {
                        updateButtons(); // –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ø—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
                        return;
                    }

                    const imageRect = mainImage.getBoundingClientRect();
                    const imageHeight = imageRect.height;

                    if (imageHeight <= 0) {
                        updateButtons();
                        return;
                    }

                    const btnHeight = btnPrev.offsetHeight;
                    const totalButtonsHeight = btnHeight * 2;
                    const gap = 24; // gap-6 –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ –∏ —Ç—Ä–µ–∫–æ–º

                    const desiredTrackHeight = imageHeight - totalButtonsHeight - gap;

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É —Ç—Ä–µ–∫–∞
                    if (desiredTrackHeight > 100) {
                        track.style.maxHeight = `${desiredTrackHeight}px`;
                        track.style.height = `${desiredTrackHeight}px`;
                    } else {
                        track.style.maxHeight = '400px';
                        track.style.height = '400px';
                    }

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¢–û–õ–¨–ö–û –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
                    container.style.height = `${imageHeight}px`;
                    container.style.maxHeight = `${imageHeight}px`;

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                    updateButtons();
                }

                // –í—ã–∑–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                window.addEventListener('load', () => {
                    updateThumbnailSliderHeight();
                    updateButtons(); // —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫
                });

                // –ü—Ä–∏ —Ä–µ—Å–∞–π–∑–µ
                window.addEventListener('resize', () => {
                    updateThumbnailSliderHeight();
                    updateButtons();
                });

                // –ï—Å–ª–∏ –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ–∑–∂–µ
                document.querySelector('.w-full > img')?.addEventListener('load', updateThumbnailSliderHeight);

                // --------------------------------------------

                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                document.addEventListener("DOMContentLoaded", () => {
                    const mainImageContainer = document.getElementById("mainImageContainer");
                    const mainImage = document.getElementById("main-product-image");
                    const modalOverlay = document.querySelector(".modal-overlay");
                    const zoomedImage = document.getElementById("zoomedImage");

                    // –û—Ç–∫—Ä—ã—Ç–∏–µ
                    mainImageContainer.addEventListener("click", () => {
                        if (modalOverlay.classList.contains("flex")) return;

                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º src
                        zoomedImage.src = mainImage.src;

                        // 1. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π (–Ω–æ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–∫–∞)
                        modalOverlay.classList.remove("hidden");
                        modalOverlay.classList.add("flex");

                        // 2. –û–±–Ω—É–ª—è–µ–º —Å—Ç–∏–ª—å, —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                        zoomedImage.classList.remove("scale-100", "opacity-100");
                        zoomedImage.classList.add("scale-95", "opacity-0");

                        // 3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π reflow ‚Äî –∑–∞—Å—Ç–∞–≤–ª—è–µ–º –±—Ä–∞—É–∑–µ—Ä "—É–≤–∏–¥–µ—Ç—å" –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                        zoomedImage.offsetHeight; // —ç—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç reflow

                        // 4. –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
                        requestAnimationFrame(() => {
                            zoomedImage.classList.remove("scale-95", "opacity-0");
                            zoomedImage.classList.add("scale-100", "opacity-100");
                        });
                    });

                    // –ó–∞–∫—Ä—ã—Ç–∏–µ
                    function closeModal() {
                        // –£–±–∏—Ä–∞–µ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
                        zoomedImage.classList.remove("scale-100", "opacity-100");
                        zoomedImage.classList.add("scale-95", "opacity-0");

                        // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
                        setTimeout(() => {
                            modalOverlay.classList.remove("flex");
                            modalOverlay.classList.add("hidden");
                            zoomedImage.src = ""; // –æ—á–∏—â–∞–µ–º
                        }, 300);
                    }

                    // –ö–ª–∏–∫ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç
                    zoomedImage.addEventListener("click", (e) => {
                        e.stopPropagation();
                        closeModal();
                    });

                    // –ö–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ—Ç
                    modalOverlay.addEventListener("click", closeModal);

                    // –ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–∞ Escape (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ)
                    window.addEventListener("keydown", (e) => {
                        if (e.key === "Escape" && modalOverlay.classList.contains("flex")) {
                            closeModal();
                        }
                    });
                });
            </script>
            <?php } ?>

            <div class="info">
                <!-- –ë–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
                <div class="md:block hidden">
                    <div class="flex items-center justify-between">
                        <div class="flex gap-4 items-center mt-auto text-gray-500 text-sm mb-3">
                            <button class="hover:opacity-50">
                                <img src="/images/index/izbr_small.png" </button>
                            <button class="hover:opacity-50">
                                <img src="/images/index/srav_small.png" </button>
                        </div>
                        <div class="flex gap-4 items-center mt-auto text-gray-500 text-sm mb-3">
                            <button class="hover:opacity-50">&lt; –ü—Ä–µ–¥.—Ç–æ–≤–∞—Ä</button>
                            <button class="hover:opacity-50">–°–ª–µ–¥.—Ç–æ–≤–∞—Ä &gt;</button>
                        </div>
                    </div>

                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                    <h1 class="text-2xl font-bold leading-snug mb-3">
                        <?php echo $pageInf['header']; ?>
                    </h1>

                </div>
                <div class="articleandstores clearfix">
                    <?php /*<div class="article">–ö–æ–¥ —Ç–æ–≤–∞—Ä–∞: <?php echo $seriesInf['id']?></div>*/?>
                <div class="stores">
							<span>
								<?php /*–ù–∞–ª–∏—á–∏–µ
								<?php if($seriesInf['in_stock']) { ?>
                                <span style="color:#00cc00;">–ï—Å—Ç—å</span>
                                <?php } else { ?>
                                <span style="color:#ff0000;">–ù–µ—Ç</span>
                                <?php } ?>*/?>
							</span>
                </div>
            </div>
            <div class="mods" style=" margin-top: 0;">
                <?php if(is_array($itemsGroups) && count($itemsGroups)) { ?>
                <h3 class="title2 green"><a href="#series-items-title">–¶–µ–Ω—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã</a></h3>
                <?php } ?>
                <?php if(is_array($options) &&  count($options)) { ?>
                <h3 class="title2"><a href="#options-block" onclick="$('#description-options').prop('checked', true);">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</a></h3>
                <?php } ?>
                <div class="favoriteandcheaper">
                    <div class="cheaper">
                        <a
                                rel="nofollow"
                                class="cheaper detail fancyajax fancybox.ajax"
                                href="<?php echo Url::a('contacts')?>?reason=<?php echo Contacts_Feedback::REASON_CHEAPER; ?>"
                                title="–ù–∞—à–ª–∏ –¥–µ—à–µ–≤–ª–µ?"><div style="font-size: 19px;">–ù–ê–®–õ–ò –î–ï–®–ï–í–õ–ï?</div>
                        </a>
                    </div>
                </div>
                <br><br>
                <div class="clear"></div>
                <br><br>
            </div>
            <div class="seriespage-left">
                <!-- –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞ -->
                <div>
                    <p id="item-<?php echo $itemInf['id']; ?>-price-old" class="text-sm text-gray-500 line-through">
                        <?php
			$d = abs($itemInf['discount']);
			if ($d != 1 && $d != 0) {
				echo Catalog::priceFormat($itemInf['price_min'] / $d) . ' ‚ÇΩ';
			}
		?>
                    </p>
                    <div id="item-<?php echo $itemInf['id']; ?>-price" class="text-3xl font-bold text-black">
                        <?php if(abs($itemInf['price_min'])): ?>
                        <?php echo Catalog::priceFormat($itemInf['price_min']) ?> ‚ÇΩ
                        <?php else: ?>
                        –¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É
                        <?php endif; ?>
                    </div>
                </div>

                <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ + –∫–Ω–æ–ø–∫–∏ -->
                <div class="flex items-center w-fit gap-6 py-2 px-4 bg-white border border-[#E4E4E4] rounded-lg mt-6">
                    <a href="javascript:void(0)" class="text-4xl text-gray-600 minus js-minus">‚àí</a>
                    <span class="text-sm font-medium">
		<input type="text" class="js-quantity w-10 text-center border-none outline-none" name="amount" value="<?php echo ($catInf['parent_id'] == 38 || $catInf['id'] == 9) ? '4' : '1'; ?>" data-ratio="1">
		<span class="js-measurename">—à—Ç</span>
	</span>
                    <a href="javascript:void(0)" class="text-3xl text-gray-600 plus js-plus">+</a>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="flex flex-col sm:flex-row gap-3 mt-6">
                    <?php if(Catalog_Cart::isItemInCart($itemInf['id'])): ?>
                    <button
                            type="button"
                            class="bg-green-600 text-white py-2 px-12 rounded text-center font-semibold cursor-not-allowed opacity-90"
                            disabled
                    >
                        ‚úì –í –∫–æ—Ä–∑–∏–Ω–µ
                    </button>
                    <?php else: ?>
                    <form
                            class="add2basketform main-cart-form"
                            action="<?php echo Url::a('catalog-cart') ?>"
                            method="get"
                            onsubmit="oCart.add(this); return false;"
                    >
                        <input type="hidden" name="add" value="<?php echo $itemInf['id']; ?>">
                        <input type="hidden" name="amount" value="1">
                        <input type="hidden" name="material_id" value="<?php echo ($mActive ? $mActive['id'] : 0); ?>">
                        <button
                                type="submit"
                                class="bg-blue-600 text-white py-2 px-12 rounded text-center font-semibold hover:bg-blue-700 transition-colors shadow-lg hover:shadow-xl"
                                title="–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É"
                        <?php if($seriesInf['out_of_production']) echo 'disabled'; ?>
                        >
                        –û—Ç–ª–æ–∂–∏—Ç—å –≤ 1 –∫–ª–∏–∫ —Å–æ –°–ö–ò–î–ö–û–ô
                        </button>
                    </form>


                    <?php endif; ?>

                    <a
                            rel="nofollow"
                            class="border-2 border-blue-600 text-blue-600 py-2 px-12 rounded text-center font-semibold hover:bg-blue-50 transition-colors"
                            href="<?php echo Url::a('contacts')?>?reason=<?php echo Contacts_Feedback::REASON_CHEAPER; ?>"
                            title="–ù–∞—à–ª–∏ –¥–µ—à–µ–≤–ª–µ?"
                    >
                        –ù–∞—à–ª–∏ –¥–µ—à–µ–≤–ª–µ?
                    </a>
                </div>

                <!-- –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã -->
                <div class="flex flex-col md:flex-row gap-6 mt-8">
                    <!-- –î–æ—Å—Ç–∞–≤–∫–∞ -->
                    <div class="text-sm space-y-1">
                        <p>
                            <img class="inline-block w-4 h-3" src="/images/product/truck.png" />
                            <span class="underline">–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
                            <span class="underline font-bold">2‚Äì4 –¥–Ω—è</span>
                        </p>
                        <p>
                            <span class="underline">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞ (–ø–æ –ú–æ—Å–∫–≤–µ <br />–∏ –ú–û):</span>
                            <span class="font-semibold">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è</span>
                        </p>
                    </div>

                    <!-- –°–æ—Ü—Å–µ—Ç–∏ -->
                    <div class="flex flex-col">
                        <p class="text-sm mb-1">–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã:</p>
                        <div class="flex gap-3 text-xl mt-1">
                            <a target="_blank" title="WhatsApp" href="https://wa.me/79859204824">
                                <img src="/images/product/soc_wt.png" class="w-8 h-8" alt="WhatsApp" />
                            </a>
                            <a target="_blank" title="Vk" href="https://vk.com/mebelioniru">
                                <img src="/images/product/soc_vk.png" class="w-8 h-8" alt="–í–ö–æ–Ω—Ç–∞–∫—Ç–µ" />
                            </a>
                            <a target="_blank" title="Tik Tok" href="https://www.tiktok.com/@mebelioni.ru?lang=ru-RU">
                                <img src="/images/product/soc_tt.png" class="w-8 h-8" alt="TikTok" />
                            </a>
                        </div>
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ –≤—ã–±–æ—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (–¥–ª—è JS/–Ω–µ-JS) -->
                <div class="material-nojs mt-8">
                    <select name="material_id" id="item-<?php echo $itemInf['id']; ?>-material" style="max-width: 240px;" class="block w-full p-2 border rounded">
                        <?php foreach($itemInf['materials'] as $im): ?>
                        <?php $m = $materials[$im['material_id']]; ?>
                        <?php if(!$m) continue; ?>
                        <option value="<?php echo $im['material_id']; ?>" <?php if($mActive && $m['id'] == $mActive['id']) echo 'selected'; ?>>
                        <?php echo $m['name']; ?>
                        <?php if($m['has_sub'] && !empty($m['sub'])): ?>
                        <?php $firstSub = array_values($m['sub'])[0]; ?>
                        <?php if($firstSub['has_sub'] && !empty($firstSub['sub'])): ?>
                        <?php $secondSub = array_values($firstSub['sub'])[0]; ?>
                        / <?php echo $firstSub['name']; ?> / <?php echo $secondSub['name']; ?>
                        <?php else: ?>
                        / <?php echo $firstSub['name']; ?>
                        <?php endif; ?>
                        <?php endif; ?>
                        <?php if(abs($im['price'])): ?>
                        (<?php echo Catalog::priceFormat($im['price']); ?> —Ä.)
                        <?php else: ?>
                        (–ø–æ –∑–∞–ø—Ä–æ—Å—É)
                        <?php endif; ?>
                        </option>
                        <?php endforeach; ?>
                    </select>
                </div>

                <div class="threeblock clearfix">
                    <div class="compare">
                        <a rel="nofollow" class="add2compare" href="/catalog/mebel_dlya_gostinnoy/kresla/kreslo_van_gog/?action=ADD_TO_COMPARE_LIST&amp;id=">
                            <i class="icon pngicons"></i>
                            –î–æ–±–∞–≤–∏—Ç—å –∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é
                        </a>
                    </div>
                    <?php $fc = trim(Options::name('found-cheaper')); ?>
                    <?php if($fc !== '' && $fc !== '&nbsp;') { ?>

                    <?php } ?>
                </div>
                <div class="share">
                    <div style="margin-bottom:25px;">
                        <div style="margin-bottom:6px;text-transform:uppercase;">
                            –°–æ—Ü—Å–µ—Ç–∏
                        </div>
                        <a target="_blank" title="WhatsApp" class="icon_social wa" href="https://wa.me/79859204824"></a>
                        <a href="https://zen.yandex.ru/id/61bd9b90a5e7c35fbfbcad55" target="_blank" title="Yandex Zen" class="icon_social zen"></a>
                        <a href="https://vk.com/mebelioniru" target="_blank" title="Vk" class="icon_social vk"></a>
                        <a href="https://ok.ru/group/61739138941100" target="_blank" title="Ok" class="icon_social ok"></a>
                        <a href="https://www.tiktok.com/@mebelioni.ru?lang=ru-RU" target="_blank" title="Tik Tok" class="icon_social tiktok"></a>
                    </div>
                </div>

                <?php
                        foreach($itemInf['materials'] as $n => $im){
                if(!isset($materials[$im['material_id']])){
                unset($itemInf['materials'][$n]);
                }
                }
                $itemInf['materials'] = array_values($itemInf['materials']);
                ?>

                <?php
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —ç—Ç–æ –∑–∞—â–∏—Ç–∏—Ç –æ—Ç –æ—à–∏–±–∫–∏
$mActive = false;
$mActiveName = [];

if(count($itemInf['materials'])) {
    $materialId = $itemInf['price_min_material_id'];
    if(isset($materials[$materialId])) {
        $mActive = $materials[$materialId];
        $mActiveName = [$mActive['name']]; // –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
        while($mActive['has_sub'] && !empty($mActive['sub'])) {
            $keys = array_keys($mActive['sub']);
            $nextKey = array_shift($keys);
            if (!isset($mActive['sub'][$nextKey])) break;
            $mActive = $mActive['sub'][$nextKey];
            $mActiveName[] = $mActive['name'];
        }
    }
}

// –¢–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å $mActiveName ‚Äî –æ–Ω –≤—Å–µ–≥–¥–∞ –º–∞—Å—Å–∏–≤!
?>

                <?php if(count($itemInf['materials'])) { ?>
                <div class="item-current-material" style="float: none">
                    <span class="b2">–í—ã–±—Ä–∞–Ω —Ü–≤–µ—Ç:</span>
                    <div class="image" id="item-<?php echo $itemInf['id']; ?>-image">
                        <?php if($mActive && $mActive['image']['ext']) { ?>
                        <img src="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $mActive['image']['id']; ?>_107x87_0.<?php echo $mActive['image']['ext']; ?>" width="107" height="87" alt="">
                        <?php } ?>
                    </div>
                    <div class="name test" id="item-<?php echo $itemInf['id']; ?>-name">
                        <?php echo implode(' / ', $mActiveName); ?>
                    </div>
                </div>

                <div class="item-materials" style="margin-top: 30px;">
                    <div class="b">–¶–≤–µ—Ç–æ–≤–∞—è –≥–∞–º–º–∞</div>

                    <div id="materials-popup">
                        <div class="materials-level1" id="materials-popup-content" data-counts="0"></div>
                        <a href="javascript:void(0)" class="klink-dashed" onclick="oMaterials.openrows(); return false;">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</a>
                    </div>
                </div>

                <script>
                    <?php
                        // FIX: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ pageInf.
                        /*
                        $materialsOrder = [];
                        foreach ($materials as $id => $im) {
                            foreach ($itemInf['materials'] as $ii => $inf) {
                                if ((int)$id === (int)$inf['material_id']) {
                                    $materialsOrder[] = $inf;
                                }
                            }
                        }
                        */
                        ?>
                    oMaterials.items2mats[<?php echo $itemInf['id']; ?>] = AJAX.jsonDecode('<?php echo str_replace('\'', '\\\'', toJson($itemInf['materials'])); ?>');
                    onLoad(function(){
                        //oMaterials.setRowSize(1, 4);
                        oMaterials.open(<?php echo $itemInf['id']; ?>);
                    });
                </script>
                <?php } else { ?>
                <script>
                    onLoad(function(){
                        oCart.setInfo();
                    });
                </script>
                <?php } ?>
            </div>

        </div>
    </div>

    <div class="elementdetail">
        <div class="description1">
            <?php /*if(trim($seriesInf['text']) !== '' || trim($seriesInf['video']) !== '') { ?>
            <input type="radio" name="description" value="text" id="description-text" checked>
            <label for="description-text">
                –û–ø–∏—Å–∞–Ω–∏–µ
            </label>
            <?php } */?>
            <?php if(count($options)) { ?>
            <input type="radio" name="description" value="options" id="description-options" checked>
            <label for="description-options">
                –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            </label>
            <?php } ?>

            <input type="radio" name="description" value="delivery" id="description-delivery" <?php if(trim($seriesInf['text']) === '' && trim($seriesInf['video']) === '') { ?>checked<?php } ?>>
            <label for="description-delivery">
                –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞
            </label>
            <label>
                <a href="#review">–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–∑—ã–≤—ã</a>
            </label>

            <div class="text options" id="text-options">
                <?php if(trim($seriesInf['delivery_time']) !== '') { ?>
                <span>–°—Ä–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
                <?php echo $seriesInf['delivery_time']; ?>
                <br>
                <?php } ?>
                <?php foreach($options as $o) { ?>
                <span><?php echo $o['name']; ?>:</span>
                <?php echo $o['value']; ?>
                <br>
                <?php } ?>
                <?php if(trim($itemInf['size']) !== '') { ?>
                <span>–†–∞–∑–º–µ—Ä:</span>
                <?php echo $itemInf['size']; ?>
                <br>
                <?php } ?>
                <?php if((float)($itemInf['weight'])) { ?>
                <span>–í–µ—Å:</span>
                <?php echo abs($itemInf['weight']); ?> –∫–≥
                <br>
                <?php } ?>
                <?php if((float)($itemInf['volume'])) { ?>
                <span>–û–±—ä—ë–º:</span>
                <?php echo abs($itemInf['volume']); ?> –º&sup3;
                <br>
                <?php } ?>
            </div>
            <div class="text" id="text-delivery">
                <?php
						$t = $catInf['series_info'];
						$t = str_replace('[name]', $seriesInf['name'], $t);
						$t = str_replace('%d%', '<span class="text-delivery-price info-delivery"></span>', $t);
                $t = str_replace('%a%', '<span class="text-delivery-price info-assembly"></span>', $t);
                $t = str_replace('%F%', '<span class="text-delivery-price info-unloading"></span>', $t);
                print $t;
                ?>
            </div>
        </div>
    </div>

    <div class="clear"></div>

    <?php if(count($linkages)) { ?>
    <?php foreach($linkages as $ln => $l) { ?>
    <div class="sorter_and_name clearfix">
        <div class="name" style="color: <?php echo $l['color_name']; ?>!important"><?php echo $l['name']; ?></div>
    </div>
    <div >
        <div class="grid grid-cols-2 sm2:grid-cols-4 gap-2 lg:gap-6" >
            <?php foreach($l['series'] as $s) { ?>
            <?php include(_ROOT . Catalog_Series::$tpl) ?>
            <?php } ?>
        </div>
    </div>
    <?php } ?>
    <?php } ?>


    <noindex>
        <div class="series_options">
            <div class="series_options_item">
                <div class="series_info_title">
                    <?php echo Options::name('series-info1-title'); ?>
                </div>
                <div class="series_info_text">
                    <?php echo Options::name('series-info1-text'); ?>
                </div>
            </div>
            <div class="series_options_item">
                <div class="series_info_title">
                    <?php echo Options::name('series-info2-title'); ?>
                </div>
                <div class="series_info_text">
                    <?php echo Options::name('series-info2-text'); ?>
                </div>
            </div>
            <div class="series_options_item">
                <div class="series_info_title">
                    <?php echo Options::name('series-info3-title'); ?>
                </div>
                <div class="series_info_text">
                    <?php echo Options::name('series-info3-text'); ?>
                </div>
            </div>
        </div>
    </noindex>

    <div class="detailtabs tabs">
        <div class="headers clearfix">
            <h3>–û—Ç–∑—ã–≤—ã</h3>
        </div>
        <br>
        <?php
                if (!count($comments)) {
                    ?><p class="errortext">–ï—â–µ –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–¥–µ–ª–∏–ª—Å—è —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p><?php
                } else {
                    $formatter = new IntlDateFormatter(
                        'ru_RU',
                        IntlDateFormatter::LONG,
                        IntlDateFormatter::LONG
                    );
                    $formatter->setPattern('d MMMM yyyy');

        foreach ($comments as $comment) {
        ?>
        <div class="reviewmessages">
            <div class="message">
                <div class="name">
                    <?php echo $comment['name']; ?>
                    <?php
                                    if ($comment['rate'] > 0) {
                    echo '<div class="rating">';
                    for ($i = 1; $i <= $comment['rate']; $i++) {
                    echo '<span class="icon pngicons star"></span>';
                    }
                    echo '</div>';
                    }
                    ?>
                </div>
                <p class="date"><?php echo $formatter->format(new DateTimeImmutable($comment['date'])); ?></p>
                <br>
                <p class="body"><?php echo $comment['text']; ?></p>
            </div>
        </div>
        <?php
                    }
                    ?>
        <?php
                }
                ?>

        <div class="contents">
            <div class="content selected review" id="review">
                <div class="contentbody clearfix">
                    <p><br></p>
                    <p><a class="add2review btn3" href="#addreview">–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a></p>
                    <p><br></p>

                    <?php
                            if (isset($_SESSION['review_flash_msg'])) {
                                echo $_SESSION['review_flash_msg'];
                            }

                            if (!isset($_SESSION['review_flash_status']) || $_SESSION['review_flash_status']) {
                            ?>

                    <div id="detailreviews">
                        <div class="contentinner">
                            <div class="reviewform noned">
                                <form action="" method="POST" id="reviewForm"> <!--  onsubmit="return RSGoPro_SummComment(this);" -->

                                    <input type="hidden" name="series" value="<?php echo $seriesInf['id']; ?>">
                                    <input type="hidden" name="csrf_token" value="<?php echo $pageInf['csrf_token']; ?>">

                                    <div class="rating clearfix">
                                        <input type="hidden" name="REVIEW_TEXT_rate" value="<?php echo isset($_SESSION['rating']) ? $_SESSION['rating'] : '0'; ?>">
                                        <span>–û—Ü–µ–Ω–∏—Ç–µ —Ç–æ–≤–∞—Ä: </span>
                                        <a class="icon pngicons" href="#" data-id="1"></a>
                                        <a class="icon pngicons" href="#" data-id="2"></a>
                                        <a class="icon pngicons" href="#" data-id="3"></a>
                                        <a class="icon pngicons" href="#" data-id="4"></a>
                                        <a class="icon pngicons" href="#" data-id="5"></a>
                                    </div>

                                    <div class="fieldname">
                                        –í–∞—à–µ –∏–º—è
                                    </div>

                                    <input type="text" name="REVIEW_AUTHOR" id="REVIEW_USER" maxlength="192" value="<?php echo isset($_SESSION['review_name']) ? $_SESSION['review_name'] : '–ì–æ—Å—Ç—å'; ?>" required>

                                    <div class="fieldname">
                                        –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π e-mail
                                    </div>

                                    <input type="email" name="REVIEW_AUTHOR_EMAIL" id="REVIEW_EMAIL" value="<?php echo isset($_SESSION['review_email']) ? $_SESSION['review_email'] : ''; ?>" required>
                                    <br><small>–ù–µ –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –Ω–∞ —Å–∞–π—Ç–µ.</small>

                                    <div class="fieldname">
                                        –í–∞—à –æ—Ç–∑—ã–≤
                                    </div>
                                    <textarea class="comment" name="REVIEW_TEXT_comment" id="REVIEW_TEXT_comment" required><?php echo isset($_SESSION['review_comment']) ? $_SESSION['review_comment'] : ''; ?></textarea>
                                    <br>
                                    <input class="send" name="send_button" id="send_review" type="button" value="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                                </form>
                            </div>
                        </div>

                        <script>
                            //$('#detailreviews').find('.reviewform').removeClass('noned');
                        </script>
                    </div>
                    <?php
                            }

                            unset($_SESSION['review_flash_msg']);
                            unset($_SESSION['review_flash_status']);

                            unset($_SESSION['review_name']);
                            unset($_SESSION['review_email']);
                            unset($_SESSION['review_comment']);
                            unset($_SESSION['review_rating']);
                            ?>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
