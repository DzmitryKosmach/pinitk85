<!-- Карточка товара -->
<div
  class="js-element simple propvision1 bg-white rounded-lg shadow p-4 lg:p-6 flex flex-col shadow hover:shadow-lg transition-shadow duration-300"
>
  <!-- Изображение + маркер -->
  <div class="relative">
    <?php if (!empty($s['marker'])) { ?>
    <div>
      <span
        class="absolute top-[-14px] left-[-14px] lg:top-[-20px] lg:left-[-20px] bg-[#f0f0f0] rounded-md text-xs lg:text-sm font-semibold text-white px-2 lg:px-4 py-1"
        style="color: <?php echo htmlspecialchars($s['marker']['color']); ?>;
                       /*<?php if (!empty($s['marker']['shadow'])) echo 'text-shadow: 0 1px 1px rgba(0,0,0, 0.7);' ?>*/
                       white-space: normal;"
      >
        <?php
              $text = $s['marker']['text'];
              // Заменяем <br>, <br />, <br />
        и т.п. на пробел $text = preg_replace('/<br\s*\/?>/', ' ', $text); //
        Удаляем все остальные теги $text = strip_tags($text); // Не трогаем
        пробелы — оставляем как есть echo $text; ?>
      </span>
    </div>
    <?php } ?>

    <a class="flex justify-center" href="<?php echo Catalog_Series::a($s); ?>">
      <img
        src="<?php echo Catalog::photoUrl(
                Catalog_Series_Photos::$imagePath,
                $s['1st_photo']['id'], 170, 170, $s['1st_photo']['rm'], $s['1st_photo']['_img_ext']
            ); ?>"
        alt="<?php echo hsch(
                mb_strtolower(Catalog_Categories::name1($s['category_id'])) . ' ' . mb_strtolower($s['name'])
            ); ?>"
        title="<?php echo hsch(
                mb_strtolower(Catalog_Categories::name1($s['category_id'])) . ' ' . mb_strtolower($s['name'])
            ); ?>"
        class="max-w-full h-auto object-contain rounded-md mb-4"
      />
    </a>
  </div>

  <!-- Название -->
  <div class="relative mb-1" style="height: 2.5em">
    <h3
      class="font-medium text-sm sm2:text-base lg:text-lg leading-5 line-clamp-2 transition-all duration-200 absolute top-0 left-0 right-0 hover:line-clamp-none hover:z-10 hover:bg-white hover:shadow-lg hover:rounded hover:px-2 hover:py-1"
    >
      <a
        href="<?php echo Catalog_Series::a($s); ?>"
        class="text-inherit hover:text-inherit block"
      >
        <?php echo htmlspecialchars($s['name']); ?>
      </a>
    </h3>
  </div>

  <!-- Цвета -->
  <div class="flex gap-[6px] justify-start items-center mt-8 mb-3">
    <?php
        $materials = [];
        foreach ($s['materials'] as $m) {
            $materials[] = [
                'name' =>
    $m['name'], 'img' => Config::pathRel('images') .
    Catalog_Materials::$imagePath . $m['id'] . '_20x20_0.' . $m['_img_ext'] ]; }
    ?>

    <!-- Отображаем первые 7 цветов как квадратики -->
    <?php $count = 0; ?>
    <?php foreach ($materials as $m): ?>
    <?php if ($count >= 7) break; // Ограничиваем 7 цветами ?>
    <span
      class="w-[14px] h-[14px] sm2:w-[18px] sm2:h-[18px] lg:w-[22px] lg:h-[22px] rounded inline-block"
      style="
        background-image: url('<?php echo htmlspecialchars($m['img']); ?>');
        background-size: cover;
      "
      title="<?php echo htmlspecialchars($m['name']); ?>"
    >
    </span>
    <?php $count++; ?>
    <?php endforeach; ?>

    <!-- Если больше 7 — показываем "ещё" через hover -->
    <?php if (count($materials) >
    7): ?>
    <div class="relative group">
      <svg
        width="16"
        height="9"
        viewBox="0 0 16 9"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M7.29289 8.70721C7.68342 9.09773 8.31658 9.09773 8.70711 8.70721L15.0711 2.34325C15.4616 1.95272 15.4616 1.31956 15.0711 0.929032C14.6805 0.538508 14.0474 0.538508 13.6569 0.929032L8 6.58589L2.34315 0.929032C1.95262 0.538508 1.31946 0.538508 0.928932 0.929032C0.538408 1.31956 0.538408 1.95272 0.928932 2.34325L7.29289 8.70721ZM8 8H7V8.0001H8H9V8H8Z"
          fill="#020202"
        />
      </svg>

      <!-- Всплывающее окно с оставшимися цветами -->
      <div
        class="absolute left-0 top-full mt-2 hidden group-hover:block z-10 bg-white border rounded-lg shadow-md w-40 p-2"
      >
        <?php for ($i = 7; $i < count($materials); $i++): ?>
        <span
          class="w-[14px] h-[14px] sm2:w-[18px] sm2:h-[18px] lg:w-[22px] lg:h-[22px] rounded inline-block mr-1"
          style="
            background-image: url('<?php echo htmlspecialchars($materials[$i]['img']); ?>');
            background-size: cover;
          "
          title="<?php echo htmlspecialchars($materials[$i]['name']); ?>"
        >
        </span>
        <?php endfor; ?>
      </div>
    </div>
    <?php endif; ?>
  </div>

  <div class="flex flex-col sm:flex-row justify-between items-center mb-1">
    <!-- Цена -->
    <div class="font-bold text-base sm:text-lg leading-2 mt-[-6px]">
      <?php if (abs($s['price_search_min']) || abs($s['price_search_max'])): ?>
      <?php echo ($s['price_search_title'] ? $s['price_search_title'] : 'от') ?>
      <?php echo Catalog::priceFormat(floor($s['price_search_min'])) ?>
      ₽
      <?php elseif (abs($s['price_min'])): ?>
      от
      <?php echo Catalog::priceFormat(floor($s['price_min'])) ?>
      ₽
      <?php endif; ?>
    </div>

    <div
      class="flex w-full sm:w-auto justify-between gap-2 items-center mt-auto text-gray-500 text-sm mb-3"
    >
      <!-- Избранное -->
      <div>
        <a
          href="javascript:void(0)"
          class="hover:opacity-50"
          title="В избранное"
        >
          <img
            src="/images/index/izbr_small.png"
            alt="Избранное"
            class="w-5 h-5"
          />
        </a>
      </div>

      <!-- Сравнение -->
      <div class="threeblock clearfix compare">
        <!-- Кнопка "Добавить к сравнению" -->
        <div
          class="series-compare-add <?php if (Catalog_Compare::check($s['id'])): ?>hidden<?php endif; ?>"
          data-id="<?php echo (int)$s['id']; ?>"
        >
          <a
            rel="nofollow"
            class="add2compare hover:opacity-50"
            href="javascript:void(0)"
            onclick="oCompare.add(<?php echo $s['id']; ?>); return false;"
            title="Добавить к сравнению"
          >
            <svg
              width="26"
              height="26"
              viewBox="0 0 34 34"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M4.25 16.9987H7.08333V29.7487H4.25V16.9987ZM26.9167 11.332H29.75V29.7487H26.9167V11.332ZM15.5833 2.83203H18.4167V29.7487H15.5833V2.83203Z"
                fill="#3C3C3A"
              />
            </svg>
          </a>
        </div>

        <!-- Кнопка "Убрать из сравнения" -->
        <div
          class="series-compare-remove <?php if (!Catalog_Compare::check($s['id'])): ?>hidden<?php endif; ?>"
          data-id="<?php echo (int)$s['id']; ?>"
        >
          <a
            rel="nofollow"
            class="add2compare hover:opacity-50"
            href="javascript:void(0)"
            onclick="oCompare.remove(<?php echo $s['id']; ?>); return false;"
            title="Убрать из сравнения"
          >
            <svg
              width="26"
              height="26"
              viewBox="0 0 34 34"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g
                stroke="#FF0000"
                stroke-width="3.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                transform="translate(8,0)"
              >
                <line x1="13" y1="2" x2="21" y2="10" />
                <line x1="21" y1="2" x2="13" y2="10" />
              </g>
              <g transform="translate(0,3)">
                <path
                  d="M4.25 16.9987H7.08333V29.7487H4.25V16.9987ZM26.9167 11.332H29.75V29.7487H26.9167V11.332ZM15.5833 2.83203H18.4167V29.7487H15.5833V2.83203Z"
                  fill="#3C3C3A"
                />
              </g>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Кнопка "Подробнее" -->
  <a
    href="<?php echo Catalog_Series::a($s); ?>"
    class="mt-auto text-center border-[3px] border-blue-600 text-blue-600 rounded-md px-4 py-2 hover:bg-blue-50 transition"
  >
    Подробнее
  </a>
</div>
