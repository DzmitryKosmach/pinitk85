<style type="text/css">
  .fancybox-opened .fancybox-outer { padding-top: 30px!important; }
  .elementdetail { gap: 1.5rem; }
  .mods { margin-top: 0; }
  .title2 { font-size: 1.25rem; font-weight: 600; }
  @media (min-width:768px){ .title2{ font-size: 1.5rem; } }
  .item-series-name { margin-top: 0.5rem; margin-bottom: 0.5rem; color: #111827; }
  .options .b { font-weight: 600; font-size: 1rem; margin-bottom: 0.5rem; }
  .options span { display: inline-block; margin-top: 0.25rem; }
  .soloprice { margin-bottom: 1rem; }
  .soloprice .line .name { color: #374151; }
  .price.gen { font-size: 1.125rem; }
  .price-by-request { font-style: italic; color: #6b7280; }
  .add2basketform { display: flex; align-items: center; gap: 0.75rem; }
  .quantitytitle { color: #374151; }
  .quantity { display: inline-flex; align-items: center; gap: 0.5rem; }
  .quantity .js-minus, .quantity .js-plus { display: inline-block; width: 2rem; height: 2rem; line-height: 2rem; text-align: center; border: 1px solid #d1d5db; border-radius: 0.375rem; cursor: pointer; }
  .quantity .js-quantity { width: 3rem; text-align: center; border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.25rem 0.5rem; }
  .item-current-material .b { font-weight: 600; }
  .item-current-material .image img { border: 1px solid #e5e7eb; border-radius: 0.25rem; }
  .item-materials .b { font-weight: 600; margin-bottom: 0.5rem; }
  .material-nojs select { border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem; }
  .cl { clear: both; }
  .clearfix::after { content: ""; display: table; clear: both; }

  /* Materials popup minimal styles (including image-big preview) */
  #materials-popup { display:block; position:relative; box-sizing:border-box; width:360px; }
  #materials-popup-content { width:360px; }
  #materials-level1-content, #materials-level2-content, #materials-level3-content {
    position:relative; z-index:1000; overflow-y:scroll; overflow-x:hidden; height:300px;
  }
  #materials-level2-content { width:300px; padding:20px; }
  #materials-popup .materials-row { position:relative; z-index:100; width:330px; height:125px; margin:0 0 20px 0; }
  #materials-popup .material { display:block; position:relative; float:left; box-sizing:border-box; width:110px; height:135px; margin:0; text-decoration:none; border-radius:4px; }
  #materials-popup .material .material-in { box-sizing:border-box; width:95px; height:inherit; }
  #materials-popup .material .image, .item-current-material .image { display:block; position:relative; width:76px; height:61px; margin-bottom:2px; border:2px solid #fff; box-shadow:0 1px 6px 0 rgba(0,0,0,0.3); }
  #materials-popup .material .image .image-big {
    display:none; position:absolute; z-index:800; width:164px; height:132px; left:-32px; top:-65px;
    background:#fff; border:2px solid #fff; box-shadow:0 1px 4px 0 rgba(0,0,0,0.3);
  }
  #materials-popup .material .image:hover .image-big { display:block; }
  #materials-popup .material .info { height:55px; overflow:hidden; padding-left:2px; }
  #materials-popup .material .name { display:table-cell; vertical-align:middle; height:26px; line-height:13px; font-size:11px; color:#0075c2; text-decoration:underline; }
  #materials-popup .material .price { display:block; white-space:nowrap; font-size:11px; }
  #materials-popup .material.active .name { font-weight:bold; }
  #materials-popup .material.active .image { border-color:#ffa800; }
  #materials-popup .material.has-sub:after { content:''; display:block; position:absolute; z-index:5; box-sizing:border-box; right:23px; top:-7px; width:30px; height:30px; background:url('/Skins/img/user/materials-popup-hassub.png') no-repeat 0 0; }
  #materials-popup .material.has-sub:hover:after { background-position:-30px 0; }
  #materials-popup .material.has-sub.active:after { background-position:-60px 0; }
  #materials-popup .materials-level2, #materials-popup .materials-level3 {
    display:inline-block; position:relative; top:-20px; z-index:50; margin:0; background:#fff; border:1px solid #7a8a93;
  }
  #materials-popup .materials-level2 { padding:20px 20px 0 20px; }
  #materials-popup .materials-level3 { padding:20px 0 0 20px; }
  #materials-popup .level-tail, .materials-level2 .level-tail, .materials-level3 .level-tail {
    position:absolute; width:15px; height:15px; left:0; top:-9px; margin-left:25px; background:#fff; border:1px solid #7a8a93; border-left:0; border-bottom:0; transform:rotate(-45deg);
  }
  #materials-popup .level-title { display:block; padding:5px 0 10px 2px; color:#737769; font-weight:normal; font-size:16px; }
  #materials-popup .level-title:after { content:':'; }
  #materials-popup .level-help { display:block; padding:0 0 15px 2px; color:#999; font-weight:normal; font-size:12px; }
</style>
<div id="content" class="content">
  <div>
    <div>
      <div class="centeringin clearfix">
        <form
          class="elementdetail js-element clearfix flex flex-col md:flex-row"
          id="catalog-item-full-<?php echo $itemInf['id']; ?>"
          action="<?php echo Url::a('catalog-cart')?>"
          method="get"
          onsubmit="oCart.add(this); return false;"
        >
          <div class="" >
            <?php if($itemInf['_img_ext']) { ?>
            <div class="pic element" style="height: auto; line-height: 100%">
              <div class="flex justify-center">
                <?php
                  $p = $photos[0];
                  ?>
                <img
                  class="js_picture_glass genimage max-w-[220px]"
                  style="cursor: default"
                  src="<?php echo Catalog::photoUrl(
                      Catalog_Items::$imagePath,
                      $itemInf['id'], 0, 0, 0, $itemInf['_img_ext'],
                      $itemInf['image-name']
                    )?>"
                  alt="<?php echo hsch($itemInf['name'] . ' ' . $itemInf['art'])?>"
                >
                <?php /*<div class="glass_lupa"></div>*/ ?>
            </div>
          </div>
          <?php /*<div class="zoom">
          <span class="text-red-600 hover:text-red-800 !text-5xl leading-none no-underline hover:!no-underline">×</span>

          Для увеличения картинки кликните на неё
      </div>*/ ?>
      <?php } ?>
    </div>

    <div class="pl-0 md:pl-8" >
      <div class="mods" style="margin-top: 0;">
        <h3 class="title2 !text-main"><?php echo $pageInf['header']; ?></h3>
        <br><br>
      </div>
      <div class="item-series-name">
        Этот элемент из коллекции:
        <a class="font-medium text-[14px] text-black" href="<?php echo Catalog_Series::a($seriesInf)?>"><?php echo $seriesHeadersAndMeta['h1']; ?></a>
        <br><br>
      </div>
      <div class="options">
        <div class="b text-black/90">Характеристики</div>

        <span class="!text-black/70">Наличие:</span>
        <span class="!text-black text-sm"><?php echo ($seriesInf['in_stock'] ? 'На складе' : 'Нет на складе')?></span><br>

        <span class="!text-black/70">Артикул:</span>
        <span class="!text-black text-sm"><?php echo $itemInf['art']; ?></span><br>

        <?php if(trim($itemInf['size']) !== '') { ?>
        <span class="!text-black/70">Размер:</span>
        <span class="!text-black text-sm"><?php echo $itemInf['size']; ?></span>
        <br>
        <?php } ?>
        <?php if((float)($itemInf['weight'])) { ?>
        <span class="!text-black/70">Вес:</span>
        <span class="!text-black text-sm"><?php echo abs($itemInf['weight'])?> кг</span>
        <br>
        <?php } ?>
        <?php if((float)($itemInf['volume'])) { ?>
        <span class="!text-black/70">Объём:</span>
        <span class="!text-black text-sm"><?php echo abs($itemInf['volume'])?> м&sup3;</span>
        <br>
        <?php } ?>
        <?php if(trim($seriesInf['delivery_time']) !== '') { ?>
        <span class="!text-black/70">Срок доставки:</span>
        <span class="!text-black text-sm"><?php echo $seriesInf['delivery_time']; ?></span>
        <br>
        <?php } ?>
        <?php $c = implode(', ', $seriesInf['tags']); ?>
        <?php if(trim($c) !== '') { ?>
        <span class="!text-black/70">Производство:</span>
        <?php echo $c?><br>
        <?php } ?>
        <?php if(trim($itemInf['text']) !== '') { ?>
        <br>
        <?php echo $itemInf['text']; ?>
        <br>
        <?php } ?>
        <br>
      </div>

      <div class="clearfix">
        <div style="float: left">
          <div class="soloprice">
            <table>
              <tr>
                <td>
                  <div class="line">
                    <span class="name">Цена товара</span>
                  </div>
                </td>
                <td class="nowrap">
                        <span class="price gen text-black/90 font-bold">
                          <span id="item-<?php echo $itemInf['id']; ?>-price" <?php if(!abs($itemInf['price_min'])) { ?>class="price-by-request"<?php } ?>>
                          <?php if(abs($itemInf['price_min'])) { ?>
                          <?php echo Catalog::priceFormat($itemInf['price_min'])?>
                          <?php } else { ?>
                          по запросу
                          <?php } ?>
                          </span>
                  </span>
                </td>
              </tr>
            </table>
          </div>
          <div class="buy">
            <div class="add2basketform main-cart-form">
                    <span class="quantitytitle">
                      Купить&nbsp; &nbsp;
                    </span>
              <span class="quantity">
                      <a class="minus js-minus">-</a>
                      <input type="text" class="js-quantity" name="amount" value="1" data-ratio="1">
                      <span class="js-measurename">шт</span>
                      <a class="plus js-plus">+</a>
                    </span>
              <input type="hidden" name="add" value="<?php echo $itemInf['id']; ?>">

              <?php if(Catalog_Cart::isItemInCart($itemInf['id'])) { ?>
              <button
                type="submit"
                class="submit inbasket"
              <?php if($seriesInf['out_of_production']) { ?>disabled<?php } ?>
              title="В корзине"
              >
              <i class="icon pngicons"></i>В корзине
              </button>
              <?php } else { ?>
              <button
                type="submit"
                class="submit add2basket !bg-main"
              <?php if($seriesInf['out_of_production']) { ?>disabled<?php } ?>
              title="Добавить в корзину"
              >
              <i class="icon pngicons"></i>Отложить
              </button>
              <?php } ?>
            </div>
          </div>
        </div>
        <div style="float: left;">
          <?php
                foreach($itemInf['materials'] as $n => $im){
          if(!isset($materials[$im['material_id']])){
          unset($itemInf['materials'][$n]);
          }
          }
          $itemInf['materials'] = array_values($itemInf['materials']);
          ?>

          <?php $mActive = false; ?>
          <?php if(count($itemInf['materials'])) { ?>
          <?php
                  $mActive = $materials[$itemInf['price_min_material_id']];
                  $mActiveName = array($mActive['name']);
                  while($mActive['has_sub'] && count($mActive['sub'])){
                                      $ak = array_keys($mActive['sub']);
                    $mActive = $mActive['sub'][array_shift($ak)];
                    $mActiveName[] = $mActive['name'];
                  }
                  ?>
          <div class="item-current-material">
            <span class="b">Выбран цвет:</span>
            <div class="image" id="item-<?php echo $itemInf['id']; ?>-image">
              <?php if($mActive['image']['ext']) { ?>
              <img src="<?php echo Config::pathRel('images') . Catalog_Materials::$imagePath . $mActive['image']['id']; ?>_76x61_0.<?php echo $mActive['image']['ext']; ?>" width="76" height="61" alt="">
              <?php } ?>
            </div>
            <div class="name" id="item-<?php echo $itemInf['id']; ?>-name">
              <?php echo implode(' / ', $mActiveName)?>
            </div>
          </div>
          <?php } ?>
        </div>
        <div class="cl"></div>
      </div>

      <?php if(count($itemInf['materials'])) { ?>
      <div class="item-materials">
        <div class="b">Цветовая гамма</div>

        <div class="material-nojs" style="padding: 0 0 20px 0;">
          <select name="material_id" id="item-<?php echo $itemInf['id']; ?>-material">
            <?php foreach($itemInf['materials'] as $im) { ?>
            <?php $m1 = $materials[$im['material_id']]; ?>
            <?php if($m1['has_sub']) { ?>
            <?php foreach($m1['sub'] as $m2) { ?>
            <?php if($m2['has_sub']) { ?>
            <?php foreach($m2['sub'] as $m3) { ?>
            <option value="<?php echo $m3['id']; ?>" <?php if($m3['id'] == $mActive['id']) { ?>selected<?php } ?>>
            <?php echo $m1['name']; ?> / <?php echo $m2['name']; ?> / <?php echo $m3['name']; ?>
            <?php if(abs($im['price'])) { ?>
            (<?php echo $im['price']; ?> р.)
            <?php } else { ?>
            (по запросу)
            <?php } ?>
            </option>
            <?php } ?>
            <?php } else { ?>
            <option value="<?php echo $m2['id']; ?>" <?php if($m2['id'] == $mActive['id']) { ?>selected<?php } ?>>
            <?php echo $m1['name']; ?> / <?php echo $m2['name']; ?>
            <?php if(abs($im['price'])) { ?>
            (<?php echo $im['price']; ?> р.)
            <?php } else { ?>
            (по запросу)
            <?php } ?>
            </option>
            <?php } ?>
            <?php } ?>
            <?php } else { ?>
            <option value="<?php echo $m1['id']; ?>" <?php if($m1['id'] == $mActive['id']) { ?>selected<?php } ?>>
            <?php echo $m1['name']; ?>
            <?php if(abs($im['price'])) { ?>
            (<?php echo $im['price']; ?> р.)
            <?php } else { ?>
            (по запросу)
            <?php } ?>
            </option>
            <?php } ?>
            <?php } ?>
          </select>
        </div>

        <style>
          #materials-level2-content {
            width: fit-content !important;
          }
        </style>

        <div id="materials-popup" class="!w-fit">
          <div class="materials-level1" id="materials-popup-content"></div>
        </div>
      </div>

      <?php } else { ?>
      <select name="material_id" style="display: none">
        <option value="0" selected></option>
      </select>
      <?php } ?>
    </div>
  </div>

  <!--<div class="cl"></div>
  <div>

  </div>-->
  </form>
</div>
</div>
</div>
<div class="cl"></div>
