<?php

$menuItems = [
    [
        'title' => 'О нас',
'url' => null,
'is_dropdown' => true,
'items' => [
['title' => 'О компании', 'url' => '/about/'],
['title' => 'Преимущества', 'url' => '/preimuschestva/'],
['title' => 'Наши сотрудники — профессионалы своего дела', 'url' => '/preimuschestva/nashi-sotrudniki-professionaly-svoego-dela/'],
['title' => 'Простота выбора', 'url' => '/preimuschestva/prostota-vybora/'],
['title' => 'Огромный выбор офисной мебели', 'url' => '/preimuschestva/ogromnyj-vybor-ofisnoj-mebeli/'],
['title' => 'Гарантия от производителя', 'url' => '/preimuschestva/garantiya-ot-proizvoditelya/'],
['title' => 'Работаем в Москве и по всей России', 'url' => '/preimuschestva/rabotaem-v-moskve-i-po-vsej-rossii/'],
['title' => 'Репутация', 'url' => '/reputation/'],
['title' => 'Наши работы', 'url' => '/clients/']
]
],
[
'title' => 'Для вас',
'url' => null,
'is_dropdown' => true,
'items' => [
['title' => 'Каталог офисной мебели', 'url' => '/catalog/'],
['title' => 'Доставка и сборка офисной мебели', 'url' => '/dostavka-i-sborka/'],
['title' => 'Низкие цены и скидки', 'url' => '/preimuschestva/nizkie-tseny-i-skidki/'],
['title' => 'Экспресс-доставка', 'url' => '/preimuschestva/ekspress-dostavka/'],
['title' => 'Удобные условия покупки', 'url' => '/preimuschestva/udobnye-usloviya-pokupki/'],
['title' => 'Новости', 'url' => '/news/'],
['title' => 'Статьи', 'url' => '/articles/']
]
],
[
'title' => 'Контакты',
'url' => '/contacts/',
'is_dropdown' => false,
'items' => []
]
];
?>


<nav id="main-nav" class="flex flex-wrap justify-center lg:justify-start gap-5 lg:gap-8 text-sm sm:text-base lg:text-lg font-semibold sm:font-medium relative z-50 transition-all duration-300">
  <?php foreach ($menuItems as $index => $menuItem): ?>
  <?php if ($menuItem['is_dropdown'] && !empty($menuItem['items'])): ?>
  <!-- Dropdown menu item -->
  <div class="dropdown relative group" data-pinned="false">
    <div class="dropdown-toggle flex items-center gap-1 cursor-pointer hover:underline">
      <span><?= htmlspecialchars($menuItem['title'], ENT_QUOTES, 'UTF-8') ?></span>
      <svg width="16" height="9" viewBox="0 0 16 9" fill="none"
           class="dropdown-arrow w-3 h-3 sm:w-4 sm:h-4 lg:w-5 lg:h-5 origin-center transition-transform"
           xmlns="http://www.w3.org/2000/svg">
        <path
          d="M7.29289 8.70721C7.68342 9.09773 8.31658 9.09773 8.70711 8.70721L15.0711 2.34325C15.4616 1.95272 15.4616 1.31956 15.0711 0.929032C14.6805 0.538508 14.0474 0.538508 13.6569 0.929032L8 6.58589L2.34315 0.929032C1.95262 0.538508 1.31946 0.538508 0.928932 0.929032C0.538408 1.31956 0.538408 1.95272 0.928932 2.34325L7.29289 8.70721ZM8 8H7V8.0001H8H9V8H8Z"
          fill="#020202" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </div>
    <div class="dropdown-menu absolute top-full <?= $index === 1 ? 'left-[-60px] sm:left-0' : 'left-0' ?> bg-white leading-4 border rounded shadow-md w-64 sm:w-72 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
      <?php foreach ($menuItem['items'] as $subItem): ?>
      <a href="<?= htmlspecialchars($subItem['url'], ENT_QUOTES, 'UTF-8') ?>"
         class="block px-4 py-2 hover:bg-main_hover_menu border-b border-gray-200 last:border-b-0">
        <?= htmlspecialchars($subItem['title'], ENT_QUOTES, 'UTF-8') ?>
      </a>
      <?php endforeach; ?>
    </div>
  </div>
  <?php else: ?>
  <!-- Simple link -->
  <a href="<?= htmlspecialchars($menuItem['url'], ENT_QUOTES, 'UTF-8') ?>" class="hover:underline">
    <?= htmlspecialchars($menuItem['title'], ENT_QUOTES, 'UTF-8') ?>
  </a>
  <?php endif; ?>
  <?php endforeach; ?>
</nav>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const dropdowns = document.querySelectorAll('.dropdown');

    dropdowns.forEach(dropdown => {
      const toggle = dropdown.querySelector('.dropdown-toggle');
      const menu = dropdown.querySelector('.dropdown-menu');
      const arrow = dropdown.querySelector('.dropdown-arrow');

      // --- ПОВЕДЕНИЕ ПРИ НАВЕДЕНИИ ---
      dropdown.addEventListener('mouseenter', () => {
        if (dropdown.getAttribute('data-pinned') !== 'true') {
          menu.classList.replace('opacity-0', 'opacity-100');
          menu.classList.replace('invisible', 'visible');
          arrow.classList.add('rotate-180');
        }
      });

      dropdown.addEventListener('mouseleave', () => {
        if (dropdown.getAttribute('data-pinned') !== 'true') {
          menu.classList.replace('opacity-100', 'opacity-0');
          menu.classList.replace('visible', 'invisible');
          arrow.classList.remove('rotate-180');
        }
      });

      // --- ПОВЕДЕНИЕ ПРИ КЛИКЕ ---
      toggle.addEventListener('click', function (e) {
        e.stopPropagation();
        const isPinned = dropdown.getAttribute('data-pinned') === 'true';

        // Снять pinned со всех остальных
        dropdowns.forEach(d => {
          if (d !== dropdown) {
            d.setAttribute('data-pinned', 'false');
            const m = d.querySelector('.dropdown-menu');
            const a = d.querySelector('.dropdown-arrow');
            if (m) {
              m.classList.replace('opacity-100', 'opacity-0');
              m.classList.replace('visible', 'invisible');
            }
            if (a) a.classList.remove('rotate-180');
          }
        });

        // Переключение pinned у текущего
        if (isPinned) {
          // Был закреплён → снять закрепление и скрыть
          dropdown.setAttribute('data-pinned', 'false');
          menu.classList.replace('opacity-100', 'opacity-0');
          menu.classList.replace('visible', 'invisible');
          arrow.classList.remove('rotate-180');
        } else {
          // Был не закреплён → закрепить и показать
          dropdown.setAttribute('data-pinned', 'true');
          menu.classList.replace('opacity-0', 'opacity-100');
          menu.classList.replace('invisible', 'visible');
          arrow.classList.add('rotate-180');
        }
      });
    });

    // --- КЛИК ВНЕ МЕНЮ ---
    document.addEventListener('click', () => {
      dropdowns.forEach(d => {
        d.setAttribute('data-pinned', 'false');
        const m = d.querySelector('.dropdown-menu');
        const a = d.querySelector('.dropdown-arrow');
        if (m) {
          m.classList.replace('opacity-100', 'opacity-0');
          m.classList.replace('visible', 'invisible');
        }
        if (a) a.classList.remove('rotate-180');
      });
    });
  });
</script>

