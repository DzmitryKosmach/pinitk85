<!-- Карточка товара -->
<div
  class="bg-white rounded-lg shadow p-4 lg:p-6 flex flex-col shadow hover:shadow-lg transition-shadow duration-300"
>
  <?php if (!empty($s['marker'])): ?>
  <div class="relative mb-2">
    <span
      class="absolute top-[-14px] left-[-14px] lg:top-[-20px] lg:left-[-20px] rounded-md text-xs font-semibold text-white px-2 py-1 z-10"
      style="background-color: #f0f0f0; color: <?php echo htmlspecialchars($s['marker']['color']); ?>;"
    >
      <?php
      $text = $s['marker']['text'] ?? '';
      $text = preg_replace('/<br\s*\/?>/', ' ', $text); $text =
      strip_tags($text); echo htmlspecialchars($text); ?>
    </span>
  </div>
  <?php endif; ?>

  <a href="<?php echo htmlspecialchars(Catalog_Series::a($s ?? '#')); ?>">
    <img
      src="<?php echo isset($s['1st_photo']) ? Catalog::photoUrl(
          Catalog_Series_Photos::$imagePath,
          $s['1st_photo']['id'], 170, 170, $s['1st_photo']['rm'], $s['1st_photo']['_img_ext']
      ) : '/images/index/chair1.jpg'; ?>"
      alt="<?php echo htmlspecialchars($s['name'] ?? 'Товар'); ?>"
      class="w-full h-48 object-contain mb-4"
    />
  </a>

  <!-- Название -->
  <div class="relative mb-1" style="height: 2.5em">
    <h3
      class="font-medium text-sm sm2:text-base lg:text-lg leading-5 line-clamp-2 transition-all duration-200 absolute top-0 left-0 right-0 hover:line-clamp-none hover:z-10 hover:bg-white hover:shadow-lg hover:rounded hover:px-2 hover:py-1"
    >
      <a
        href="<?php echo Catalog_Series::a($s); ?>"
        class="text-inherit hover:text-inherit block"
      >
        <?php echo htmlspecialchars($s['name']); ?>
      </a>
    </h3>
  </div>

  <!-- Цвета -->
  <div class="flex gap-[6px] justify-start items-center mt-8 mb-3">
    <?php
        $materials = [];
        foreach ($s['materials'] as $m) {
            $materials[] = [
                'name' =>
    $m['name'], 'img' => Config::pathRel('images') .
    Catalog_Materials::$imagePath . $m['id'] . '_20x20_0.' . $m['_img_ext'] ]; }
    ?>

    <!-- Отображаем первые 7 цветов как квадратики -->
    <?php $count = 0; ?>
    <?php foreach ($materials as $m): ?>
    <?php if ($count >= 7) break; // Ограничиваем 7 цветами ?>
    <span
      class="w-[14px] h-[14px] sm2:w-[18px] sm2:h-[18px] lg:w-[22px] lg:h-[22px] rounded inline-block"
      style="
        background-image: url('<?php echo htmlspecialchars($m['img']); ?>');
        background-size: cover;
      "
      title="<?php echo htmlspecialchars($m['name']); ?>"
    >
    </span>
    <?php $count++; ?>
    <?php endforeach; ?>

    <!-- Если больше 7 — показываем "ещё" через hover -->
    <?php if (count($materials) >
    7): ?>
    <div class="relative group">
      <svg
        width="16"
        height="9"
        viewBox="0 0 16 9"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M7.29289 8.70721C7.68342 9.09773 8.31658 9.09773 8.70711 8.70721L15.0711 2.34325C15.4616 1.95272 15.4616 1.31956 15.0711 0.929032C14.6805 0.538508 14.0474 0.538508 13.6569 0.929032L8 6.58589L2.34315 0.929032C1.95262 0.538508 1.31946 0.538508 0.928932 0.929032C0.538408 1.31956 0.538408 1.95272 0.928932 2.34325L7.29289 8.70721ZM8 8H7V8.0001H8H9V8H8Z"
          fill="#020202"
        />
      </svg>

      <!-- Всплывающее окно с оставшимися цветами -->
      <div
        class="absolute left-0 top-full mt-2 hidden group-hover:block z-10 bg-white border rounded-lg shadow-md w-40 p-2"
      >
        <?php for ($i = 7; $i < count($materials); $i++): ?>
        <span
          class="w-[14px] h-[14px] sm2:w-[18px] sm2:h-[18px] lg:w-[22px] lg:h-[22px] rounded inline-block mr-1"
          style="
            background-image: url('<?php echo htmlspecialchars($materials[$i]['img']); ?>');
            background-size: cover;
          "
          title="<?php echo htmlspecialchars($materials[$i]['name']); ?>"
        >
        </span>
        <?php endfor; ?>
      </div>
    </div>
    <?php endif; ?>
  </div>

  <div class="flex flex-col sm:flex-row justify-between items-center mb-1">
    <div>
      <?php if (isset($s['price_search_min_old']) && $s['price_search_min_old'] >
      0): ?>
      <span class="text-gray-600 text-sm line-through leading-2">
        <?php echo number_format($s['price_search_min_old'], 0, ',', ' '); ?>
        руб.
      </span>
      <?php endif; ?>
      <div class="font-bold text-base sm:text-lg leading-2 mt-[-6px]">
        <?php if (isset($s['price_search_min']) && $s['price_search_min'] >
        0): ?>
        <?php echo htmlspecialchars($s['price_search_title'] ?? 'от'); ?>
        <?php echo number_format($s['price_search_min'], 0, ',', ' '); ?>
        <?php else: ?>
        <?php echo number_format($s['price_min'] ?? 0, 0, ',', ' '); ?>
        <?php endif; ?>
        ₽
      </div>
    </div>

    <div
      class="flex w-full sm:w-auto justify-between gap-4 items-center mt-auto text-gray-500 text-sm mb-3"
    >
      <button>
        <img src="/images/index/izbr_small.png" alt="В избранное" />
      </button>

      <!-- Сравнение -->
      <div class="threeblock clearfix compare">
        <!-- Кнопка "Добавить к сравнению" -->
        <div
          class="series-compare-add <?php if (Catalog_Compare::check($s['id'])): ?>hidden<?php endif; ?>"
          data-id="<?php echo (int)$s['id']; ?>"
        >
          <a
            rel="nofollow"
            class="add2compare hover:opacity-50"
            href="javascript:void(0)"
            onclick="oCompare.add(<?php echo $s['id']; ?>); return false;"
            title="Добавить к сравнению"
          >
            <svg
              width="26"
              height="26"
              viewBox="0 0 34 34"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M4.25 16.9987H7.08333V29.7487H4.25V16.9987ZM26.9167 11.332H29.75V29.7487H26.9167V11.332ZM15.5833 2.83203H18.4167V29.7487H15.5833V2.83203Z"
                fill="#3C3C3A"
              />
            </svg>
          </a>
        </div>

        <!-- Кнопка "Убрать из сравнения" -->
        <div
          class="series-compare-remove <?php if (!Catalog_Compare::check($s['id'])): ?>hidden<?php endif; ?>"
          data-id="<?php echo (int)$s['id']; ?>"
        >
          <a
            rel="nofollow"
            class="add2compare hover:opacity-50"
            href="javascript:void(0)"
            onclick="oCompare.remove(<?php echo $s['id']; ?>); return false;"
            title="Убрать из сравнения"
          >
            <svg
              width="26"
              height="26"
              viewBox="0 0 34 34"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g
                stroke="#FF0000"
                stroke-width="3.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                transform="translate(8,0)"
              >
                <line x1="13" y1="2" x2="21" y2="10" />
                <line x1="21" y1="2" x2="13" y2="10" />
              </g>
              <g transform="translate(0,3)">
                <path
                  d="M4.25 16.9987H7.08333V29.7487H4.25V16.9987ZM26.9167 11.332H29.75V29.7487H26.9167V11.332ZM15.5833 2.83203H18.4167V29.7487H15.5833V2.83203Z"
                  fill="#3C3C3A"
                />
              </g>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>

  <a
    href="<?php echo htmlspecialchars(Catalog_Series::a($s ?? '#')); ?>"
    class="mt-auto text-center border-[3px] border-blue-600 text-blue-600 rounded-md px-4 py-2 hover:bg-blue-50 transition"
  >
    Подробнее
  </a>
</div>
